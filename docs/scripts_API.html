<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>drivers.BaseDriver &mdash; dvmdostem v0.8.1-31-gde5483c2 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/jupyter-sphinx.css" type="text/css" />
      <link rel="stylesheet" href="_static/thebelab.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom_styles.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="outspec.py" href="CLI_tools/outspec.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> dvmdostem
          </a>
              <div class="version">
                v0.8.1-31-gde5483c2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="model_overview.html">1. Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_dvmdostem.html">2. Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="software_development_info.html">3. Dev Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="SA_UQ.html">4. SA and UQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_cheat_sheet.html">5. Command Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="common_acronyms.html">6. Common Project Acronyms</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html">7. Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">8. References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples and Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prelude.html">1. Prelude</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_and_tutorials/basic_model_run.html">2. Basic Model Setup and Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_and_tutorials/example_experiment_0.html">3. EE 0 - Single Site Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_and_tutorials/data_summary_processing.html">4. Data Summary and Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_and_tutorials/plotting_discussion.html">5. Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_and_tutorials/manual_calibration.html">6. Manual Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_and_tutorials/mads_assisted_calibration.html">7. MADS Assisted Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_and_tutorials/make_contribution.html">8. Contributing to the Codebase</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_and_tutorials/using_github_features.html">9. Using Github’s Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Command Line Interfaces</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CLI_tools/SA_setup_and_run.html">SA_setup_and_run.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="CLI_tools/param.html">param.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="CLI_tools/runmask.html">runmask.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="CLI_tools/input.html">input.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="CLI_tools/qcal.html">qcal.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="CLI_tools/outspec.html">outspec.py</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Scripts API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">drivers.BaseDriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-drivers.Sensitivity">drivers.Sensitivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-drivers.MadsTEMDriver">drivers.MadsTEMDriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-SA_post_hoc_analysis">mads_calibration.SA_post_hoc_analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-util.param">util.param</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-util.output">util.output</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-util.input">util.input</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-util.metrics">util.metrics</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">dvmdostem</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">drivers.BaseDriver</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/scripts_API.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>The content in these section has been auto-generated from the python
<code class="docutils literal notranslate"><span class="pre">docstrings</span></code> in the project.</p>
<section id="module-drivers.BaseDriver">
<span id="drivers-basedriver"></span><h1>drivers.BaseDriver<a class="headerlink" href="#module-drivers.BaseDriver" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="drivers.BaseDriver.BaseDriver">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">drivers.BaseDriver.</span></span><span class="sig-name descname"><span class="pre">BaseDriver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.BaseDriver.BaseDriver" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Base class for driver objects. Specific driver classes should inherit from
BaseDriver. A driver object is intended to help with setting up and running
the dvmdostem model in a variety of patterns.</p>
<dl class="py method">
<dt class="sig sig-object py" id="drivers.BaseDriver.BaseDriver.clean">
<span class="sig-name descname"><span class="pre">clean</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.BaseDriver.BaseDriver.clean" title="Permalink to this definition"></a></dt>
<dd><p>Remove the entire tree at <cite>self.work_dir</cite>.</p>
<p>This function is NOT CAREFUL, so be careful using it!</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.BaseDriver.BaseDriver.fromfilename">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fromfilename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.BaseDriver.BaseDriver.fromfilename" title="Permalink to this definition"></a></dt>
<dd><p>Create an instance of BaseDriver from a configuration file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – The path to the configuration file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An instance of BaseDriver initialized with parameters from the
configuration file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#drivers.BaseDriver.BaseDriver" title="drivers.BaseDriver.BaseDriver">BaseDriver</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.BaseDriver.BaseDriver.load_target_data">
<span class="sig-name descname"><span class="pre">load_target_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ref_target_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.BaseDriver.BaseDriver.load_target_data" title="Permalink to this definition"></a></dt>
<dd><p>Load a set of target values from a calibration_targets.py file. When the
function is done, the targets will be available as a dictionary that is a
data member of the Driver object. There will be an
additional dict named <code class="docutils literal notranslate"><span class="pre">targets_meta</span></code> that has the metadata about the
targets, for example the corresponding NetCDF name, the units, etc.</p>
<p>Targets could also be referred to as “observations”. I.e. data that was
measured in the field and that model should be able to produce by
simulation.</p>
<p>This function reads the entire calibration_target.py file but extracts only
the targets for the CMTNUM of this driver object.</p>
<p>Note: This function loads executable code from an arbitrary loction which is
probably not ideal from a security standpoint. Maybe calibration_targets.py
should be re-facotred into a data file and a set of target utilities similar
to the parameters files.</p>
<p>Modifies/Sets: <code class="docutils literal notranslate"><span class="pre">self.targets</span></code>, <code class="docutils literal notranslate"><span class="pre">self.targets_meta</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ref_target_path</strong> (<em>str</em><em> (</em><em>path</em><em>)</em>) – A path to a folder containing a calibration_targets.py file.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – If cmtnum is not set or if there’s a problem loading targets.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.BaseDriver.BaseDriver.set_seed_path">
<span class="sig-name descname"><span class="pre">set_seed_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.BaseDriver.BaseDriver.set_seed_path" title="Permalink to this definition"></a></dt>
<dd><p>Set the seed path for the object.</p>
<p>Seed path is where the default parameter values for all the runs will be
read from. Subsequent steps may modify select parameters for individual
runs, but the original source values will be set from the seed path.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Should changing the seed path force a clean? If the seed path is set or
changed, this should probably trigger a re-build of all the working
directories…. or warn the user…?</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – The path to set as the seed path.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.BaseDriver.BaseDriver.set_work_dir">
<span class="sig-name descname"><span class="pre">set_work_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.BaseDriver.BaseDriver.set_work_dir" title="Permalink to this definition"></a></dt>
<dd><p>Set the working directory for the object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – The path to set as the working directory.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.BaseDriver.BaseDriver.setup_outputs">
<span class="sig-name descname"><span class="pre">setup_outputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.BaseDriver.BaseDriver.setup_outputs" title="Permalink to this definition"></a></dt>
<dd><p>Setup the driver’s list of output specifications based on the target
(observation) names.</p>
<p>The client must have already loaded the targets, i.e.
(<code class="docutils literal notranslate"><span class="pre">load_target_data(...)</span></code>) for this to work.</p>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">BaseDriver.outputs</span></code> is a list of dicts, each of which is an
“output specification” which contains the information that will allow a
mapping from the target names (as stored in calibration_targets.py) to the
corresponding NetCDF output. Additional informations in the specification
are the resolutions desired and a type signifier allowing us to
differentiate between fluxes and pools, which is necessary for some summary
statistics that may be calculated later.</p>
<p>This list of output specifications will be used to setup the correct outputs
in each sample specific run folder as well as conveniences like naming
columns in output summary files.</p>
<p>Sets/Modifies: <code class="docutils literal notranslate"><span class="pre">self.outputs</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>target_names</strong> (<em>list of str</em>) – The list should be strings naming targets in the calibration_targets.py
file.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – If a requested target is not found in targets dict.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="drivers.BaseDriver.deduce_target_type">
<span class="sig-prename descclassname"><span class="pre">drivers.BaseDriver.</span></span><span class="sig-name descname"><span class="pre">deduce_target_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.BaseDriver.deduce_target_type" title="Permalink to this definition"></a></dt>
<dd><p>Helper function to figure out wheter a target is a flux or a pool by
inspecting the metadata for a target.</p>
<p>TODO: Handle monthly or daily cases.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target</strong> (<em>str</em>) – The name of a target value that can be found in the calibration_targets.py
file. This name should also be a key in the <code class="docutils literal notranslate"><span class="pre">meta</span></code> argument.</p></li>
<li><p><strong>meta</strong> (<em>dict</em>) – A dictionary of metadata describing calibration targets from the
calibration_targets.py file.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>type</strong> – ‘flux’ or ‘pool’</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="drivers.BaseDriver.get_target_ncname">
<span class="sig-prename descclassname"><span class="pre">drivers.BaseDriver.</span></span><span class="sig-name descname"><span class="pre">get_target_ncname</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.BaseDriver.get_target_ncname" title="Permalink to this definition"></a></dt>
<dd><p>Looks up the NetCDF output name based on the target name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target</strong> (<em>str</em>) – The name of a target value that can be found in the calibration_targets.py
file. This name should also be a key in the <code class="docutils literal notranslate"><span class="pre">meta</span></code> argument.</p></li>
<li><p><strong>meta</strong> (<em>dict</em>) – A dictionary of metadata describing calibration targets from the
calibration_targets.py file. Must include a key for the ncname (NetCDF
name).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-drivers.Sensitivity">
<span id="drivers-sensitivity"></span><h1>drivers.Sensitivity<a class="headerlink" href="#module-drivers.Sensitivity" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">drivers.Sensitivity.</span></span><span class="sig-name descname"><span class="pre">Sensitivity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#drivers.BaseDriver.BaseDriver" title="drivers.BaseDriver.BaseDriver"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseDriver</span></code></a></p>
<p>Sensitivity Analysis Driver class.</p>
<p>Driver class for conducting a <code class="docutils literal notranslate"><span class="pre">dvmdostem</span></code> sensitivity analysis. Methods for
cleaning, setup, running model, collecting outputs.</p>
<p>Basic overview of use is like this:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Design your experiment by choosing working directory, seed path,
parameters to use, number of samples, etc.</p></li>
<li><p>Instantiate driver object.</p></li>
<li><p>Use driver object to setup the run folders.</p></li>
<li><p>Use driver object to carry out model runs.</p></li>
<li><p>Use driver object to summarize/collect outputs.</p></li>
<li><p>Use SA_post_hoc_analysis script to make plots and anaylsis.</p></li>
</ol>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.clean">
<span class="sig-name descname"><span class="pre">clean</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.clean" title="Permalink to this definition"></a></dt>
<dd><p>Remove the entire tree at <cite>self.work_dir</cite>.</p>
<p>This function is NOT CAREFUL, so be careful using it!</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.collate_results">
<span class="sig-name descname"><span class="pre">collate_results</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.collate_results" title="Permalink to this definition"></a></dt>
<dd><p>Gathers up all the results.csv files from individual ssrf folders and
stuffs them into one giant csv file. Number of rows should match rows in
sample matrix.</p>
<p>Writes file “results.csv” to the work dir.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.core_setup">
<span class="sig-name descname"><span class="pre">core_setup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.core_setup" title="Permalink to this definition"></a></dt>
<dd><p>Sets up a sample run folder for the given <code class="docutils literal notranslate"><span class="pre">idx</span></code> and <code class="docutils literal notranslate"><span class="pre">row</span></code>.</p>
<p>The following things are assumed:</p>
<blockquote>
<div><ul class="simple">
<li><p>you have called set_working_directory()</p></li>
<li><p>you have called set_seed_path()</p></li>
<li><dl class="simple">
<dt>you have called design experiment OR you at least have:</dt><dd><ul>
<li><p>a sample_matrix</p></li>
<li><p>a list of param specs</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Do all the work to setup and configure a model run. Uses the <cite>row</cite> parameter
(one row of the sample matrix) to set the parameter values for the run.</p>
<p>Currently relies on command line API for various <code class="docutils literal notranslate"><span class="pre">dvmdostem</span></code> helper
scripts. Would be nice to transition to using a Python API for all these
helper scripts (modules).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>row</strong> (<em>dict</em>) – <p>One row of the sample matrix, in dict form. So like this:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">{'cmax_pft0':</span> <span class="pre">108.2,</span> <span class="pre">'rhq10':</span> <span class="pre">34.24}</span></code></p>
</div></blockquote>
<p>with one key for each parameter name.</p>
</p></li>
<li><p><strong>idx</strong> (<em>int</em>) – The row index of the <cite>sample_matrix</cite> being worked on. Gets used to set the
run specific folder name, i.e. sample_000001.</p></li>
<li><p><strong>initial</strong> (<em>bool</em>) – A flag indicating whether the folder to be setup  is the special “initial
value” folder.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.design_experiment">
<span class="sig-name descname"><span class="pre">design_experiment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Nsamples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pftnums</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percent_diffs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sampling_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lhc'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.design_experiment" title="Permalink to this definition"></a></dt>
<dd><div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version Implemented: </span>in default constructor.</p>
</div>
<p>Builds bounds based on initial values found in dvmdostem parameter files
(cmt_*.txt files) and the <cite>percent_diffs</cite> array. The <cite>percent_diffs</cite> array
gets used to figure out how far the bounds should be from the initial value.
Defaults to initial value +/-10%.</p>
<p>Sets instance values for <cite>self.params</cite> and <cite>self.sample_matrix</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Nsamples</strong> (<em>int</em>) – How many samples to draw. One sample equates to one run to be done with
the parameter values in the sample.</p></li>
<li><p><strong>cmtnum</strong> (<em>int</em>) – Which community type number to use for initial parameter values, for doing
runs and analyzing outputs.</p></li>
<li><p><strong>params</strong> (<em>list of strings</em>) – List of parameter names to use in the experiment. Each name must be in one
of the dvmdostem parameter files (cmt_*.txt).</p></li>
<li><p><strong>pftnums</strong> (<em>list</em><em>, </em><em>same length as params list</em>) – <p>Each item in the items may be one of:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>int</p></li>
<li><p>the string ‘all’</p></li>
<li><p>list of ints</p></li>
<li><p>None</p></li>
</ol>
</div></blockquote>
<p>If the list item is an int, then that is the PFT number to be used for the
corresponding parameter. If the list item is the string ‘all’ then ALL 10
PFTs are enabled for this parameter. If the list item is a list of ints,
then the corresponding parameter will be setup for each PFT in the list.
If the list item is None, then the parameter is assumed to be a soil
parameter and no PFT info is set or needed.</p>
</p></li>
<li><p><strong>percent_diffs</strong> (<em>list of floats</em>) – List values, one for each parameter in <cite>params</cite>. The value is used to set
the bounds with respect to the intial parameter value. I.e. passing a
value in the percent_diff array of .3 would mean that bounds should be
+/-30% of the initial value of the parameter.</p></li>
<li><p><strong>TODO</strong> (<em>add somethign that lets you use non percentage based sampling range.</em>) – </p></li>
<li><p><strong>sampling_method</strong> (<em>str</em>) – A string indicating which sampling method to use for getting values for
the sample matrix. Currently the options are ‘lhc’ or ‘uniform’.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.extract_data_for_sensitivity_analysis">
<span class="sig-name descname"><span class="pre">extract_data_for_sensitivity_analysis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">posthoc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.extract_data_for_sensitivity_analysis" title="Permalink to this definition"></a></dt>
<dd><p>Creates a csv file in each run directory that summarizes the run’s
parameters and outut. The csv file will look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p_cmax</span><span class="p">,</span>  <span class="n">p_rhq10</span><span class="p">,</span>   <span class="n">p_micbnup</span><span class="p">,</span>   <span class="n">o_GPP</span><span class="p">,</span>  <span class="n">o_VEGC</span>
<span class="mf">1.215</span><span class="p">,</span>   <span class="mf">2.108</span><span class="p">,</span>     <span class="mf">0.432</span><span class="p">,</span>       <span class="mf">0.533</span><span class="p">,</span>  <span class="mf">5.112</span>
</pre></div>
</div>
<p>with one column for each parameter and one column for each output.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">For</span> <span class="n">each</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">sensitivity</span> <span class="n">matrix</span> <span class="p">(</span><span class="ow">and</span> <span class="n">corresponding</span> <span class="n">run</span> <span class="n">folder</span><span class="p">),</span>
  <span class="n">For</span> <span class="n">each</span> <span class="n">variable</span> <span class="n">specified</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">opens</span> <span class="n">the</span> <span class="n">NetCDF</span> <span class="n">files</span> <span class="n">that</span> <span class="n">were</span> <span class="n">output</span> <span class="kn">from</span> <span class="nn">dvmdostem</span>
      <span class="o">-</span> <span class="n">grabs</span> <span class="n">the</span> <span class="n">last</span> <span class="n">datapoint</span>
      <span class="o">-</span> <span class="n">writes</span> <span class="n">it</span> <span class="n">to</span> <span class="n">the</span> <span class="n">sensitivity</span><span class="o">.</span><span class="n">csv</span> <span class="n">file</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>posthoc</strong> (<em>bool</em><em> (</em><em>Not implemented yet</em><em>)</em>) – Flag for controlling whether this step should be run after the model run
or as part of the model run</p></li>
<li><p><strong>multi</strong> (<em>bool</em><em> (</em><em>Not implemented yet</em><em>)</em>) – Flag for if the runs are done all in one directory or each in its own
directory. If all runs are done in one directory then paralleization is
harder and this step of collating the output data must be done at the end
of the run before the next run overwrites it.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.first_steps_sensitivity_analysis">
<span class="sig-name descname"><span class="pre">first_steps_sensitivity_analysis</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.first_steps_sensitivity_analysis" title="Permalink to this definition"></a></dt>
<dd><p>Grab the summarized sensitivity csvs and glue them
together, then make correlation matrix. When glued together,
the data will look like this, with one row for each sample,
and one column for each parameter followed by one column for
each output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p_cmax</span><span class="p">,</span>  <span class="n">p_rhq10</span><span class="p">,</span>   <span class="n">p_micbnup</span><span class="p">,</span>   <span class="n">o_GPP</span><span class="p">,</span>  <span class="n">o_VEGC</span>
<span class="mf">1.215</span><span class="p">,</span>   <span class="mf">2.108</span><span class="p">,</span>     <span class="mf">0.432</span><span class="p">,</span>       <span class="mf">0.533</span><span class="p">,</span>  <span class="mf">5.112</span>
<span class="mf">1.315</span><span class="p">,</span>   <span class="mf">3.208</span><span class="p">,</span>     <span class="mf">0.632</span><span class="p">,</span>       <span class="mf">0.721</span><span class="p">,</span>  <span class="mf">8.325</span>
<span class="mf">1.295</span><span class="p">,</span>   <span class="mf">1.949</span><span class="p">,</span>     <span class="mf">0.468</span><span class="p">,</span>       <span class="mf">0.560</span><span class="p">,</span>  <span class="mf">5.201</span>
<span class="mf">1.189</span><span class="p">,</span>   <span class="mf">2.076</span><span class="p">,</span>     <span class="mf">0.420</span><span class="p">,</span>       <span class="mf">0.592</span><span class="p">,</span>  <span class="mf">5.310</span>
<span class="mf">1.138</span><span class="p">,</span>   <span class="mf">2.035</span><span class="p">,</span>     <span class="mf">0.441</span><span class="p">,</span>       <span class="mf">0.537</span><span class="p">,</span>  <span class="mf">5.132</span>
<span class="mf">1.156</span><span class="p">,</span>   <span class="mf">1.911</span><span class="p">,</span>     <span class="mf">0.433</span><span class="p">,</span>       <span class="mf">0.557</span><span class="p">,</span>  <span class="mf">5.192</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.fromfilename">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fromfilename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.fromfilename" title="Permalink to this definition"></a></dt>
<dd><p>Create an instance of BaseDriver from a configuration file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – The path to the configuration file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An instance of BaseDriver initialized with parameters from the
configuration file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#drivers.BaseDriver.BaseDriver" title="drivers.BaseDriver.BaseDriver">BaseDriver</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.get_initial_params_dir">
<span class="sig-name descname"><span class="pre">get_initial_params_dir</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.get_initial_params_dir" title="Permalink to this definition"></a></dt>
<dd><p>Assumes that the working directory will have an <code class="docutils literal notranslate"><span class="pre">initial_params_rundir</span></code>
directory that will have the initial parameter values.</p>
<p>Returns the path to the intial parameter run directory or None if the
objec’t <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> has not been set.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.get_sensitivity_csvs">
<span class="sig-name descname"><span class="pre">get_sensitivity_csvs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.get_sensitivity_csvs" title="Permalink to this definition"></a></dt>
<dd><p>Looks for all the sensitivity.csv files that are present in
the run directories. The sensitivity.csv files are created
using the extract_data_for_sensitivity_analysis(..) funciton.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>file_list</strong> – list of paths to sensitivity.csv files, one for each file run folder</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>list of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.info">
<span class="sig-name descname"><span class="pre">info</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.info" title="Permalink to this definition"></a></dt>
<dd><p>Print some summary info about the SensitivityDriver object.</p>
<p>Not sure how to best handle the summary of outputs yet. Maybe
a separate method. The problem is that existing outputs may
be leftover from prior runs and thus may not match the existing
params and sample_matrix data. But I don’t want to be too
aggressive in cleaning up old outputs incase they are expensive
to re-create.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.load_experiment">
<span class="sig-name descname"><span class="pre">load_experiment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">param_props_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_matrix_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">info_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.load_experiment" title="Permalink to this definition"></a></dt>
<dd><p>Load parameter properties and sample matrix from files.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.load_observations">
<span class="sig-name descname"><span class="pre">load_observations</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.load_observations" title="Permalink to this definition"></a></dt>
<dd><p>Might want this to handle obs for data that are not in the
calibration_targets.py file. This would need to be tied in with the
setup_outputs(…) function.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.load_target_data">
<span class="sig-name descname"><span class="pre">load_target_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ref_target_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.load_target_data" title="Permalink to this definition"></a></dt>
<dd><p>Load a set of target values from a calibration_targets.py file. When the
function is done, the targets will be available as a dictionary that is a
data member of the Driver object. There will be an
additional dict named <code class="docutils literal notranslate"><span class="pre">targets_meta</span></code> that has the metadata about the
targets, for example the corresponding NetCDF name, the units, etc.</p>
<p>Targets could also be referred to as “observations”. I.e. data that was
measured in the field and that model should be able to produce by
simulation.</p>
<p>This function reads the entire calibration_target.py file but extracts only
the targets for the CMTNUM of this driver object.</p>
<p>Note: This function loads executable code from an arbitrary loction which is
probably not ideal from a security standpoint. Maybe calibration_targets.py
should be re-facotred into a data file and a set of target utilities similar
to the parameters files.</p>
<p>Modifies/Sets: <code class="docutils literal notranslate"><span class="pre">self.targets</span></code>, <code class="docutils literal notranslate"><span class="pre">self.targets_meta</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ref_target_path</strong> (<em>str</em><em> (</em><em>path</em><em>)</em>) – A path to a folder containing a calibration_targets.py file.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – If cmtnum is not set or if there’s a problem loading targets.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.make_cool_plot_2">
<span class="sig-name descname"><span class="pre">make_cool_plot_2</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.make_cool_plot_2" title="Permalink to this definition"></a></dt>
<dd><p>stitches all run stages together and plots one
line for each sample run.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.plot_sensitivity_matrix">
<span class="sig-name descname"><span class="pre">plot_sensitivity_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.plot_sensitivity_matrix" title="Permalink to this definition"></a></dt>
<dd><p>Make a set of plots showing the properties of the sensitivity matrix. This
plot allows you to check that the sampling strategy is producing a
reasonable distribution of samples across the range. Usually you want to see
that the whole range is sampled evenly between the bounds and that no
samples are falling outside the bounds.</p>
<p>Shows one row of plots for each parameter with 3 different ways of viewing
the sample distributions:</p>
<blockquote>
<div><ul class="simple">
<li><p>Left column is sample values with bounds marked in red.</p></li>
<li><p>Middle column is a histogram of sample values.</p></li>
<li><p>Right column is boxplot of sample values</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>save</strong> (<em>bool</em>) – True saves plot in <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> with name
<code class="docutils literal notranslate"><span class="pre">sample_matrix_distributions.png</span></code></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.post_hoc_build_all">
<span class="sig-name descname"><span class="pre">post_hoc_build_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.post_hoc_build_all" title="Permalink to this definition"></a></dt>
<dd><p>After the run is done, go make all the ssrf results.csv files…</p>
<p>Typically these are created on-the-fly in the run_model(…) function, but
in some cases it is nice to build them again later.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.run_all_samples">
<span class="sig-name descname"><span class="pre">run_all_samples</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.run_all_samples" title="Permalink to this definition"></a></dt>
<dd><p>Starts run in each Sample Specific Run Folder.</p>
<p>Wrapper around <cite>run_model(..)</cite> that allows for parallelization.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.run_model">
<span class="sig-name descname"><span class="pre">run_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rundirectory</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.run_model" title="Permalink to this definition"></a></dt>
<dd><p>Run the model according to the setup.</p>
<p>Assumes everything is setup in a “Sample Specific Run Folder” (SSRF).</p>
<p>When the run is complete, summarize the output data into a csv file that
is written into the SSRF. The csv file has one column for each output.
The csv file should have only one row.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.save_experiment">
<span class="sig-name descname"><span class="pre">save_experiment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.save_experiment" title="Permalink to this definition"></a></dt>
<dd><p>Write the parameter properties and sensitivity matrix to files.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.set_seed_path">
<span class="sig-name descname"><span class="pre">set_seed_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.set_seed_path" title="Permalink to this definition"></a></dt>
<dd><p>Set the seed path for the object.</p>
<p>Seed path is where the default parameter values for all the runs will be
read from. Subsequent steps may modify select parameters for individual
runs, but the original source values will be set from the seed path.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Should changing the seed path force a clean? If the seed path is set or
changed, this should probably trigger a re-build of all the working
directories…. or warn the user…?</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – The path to set as the seed path.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.set_work_dir">
<span class="sig-name descname"><span class="pre">set_work_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.set_work_dir" title="Permalink to this definition"></a></dt>
<dd><p>Set the working directory for the object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – The path to set as the working directory.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.setup_multi">
<span class="sig-name descname"><span class="pre">setup_multi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.setup_multi" title="Permalink to this definition"></a></dt>
<dd><p>Makes one run directory for each row in sample matrix.</p>
<p>This is essentially a wrapper around <cite>core_setup(..)</cite>
that allows for parallelization.</p>
<p>As a result of this function, multiple sample folders will be created in
the object’s <code class="docutils literal notranslate"><span class="pre">work_dir</span></code>. There will be one sample folder for each row
of the <code class="docutils literal notranslate"><span class="pre">sample_matrix</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.setup_outputs">
<span class="sig-name descname"><span class="pre">setup_outputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.setup_outputs" title="Permalink to this definition"></a></dt>
<dd><p>Setup the driver’s list of output specifications based on the target
(observation) names.</p>
<p>The client must have already loaded the targets, i.e.
(<code class="docutils literal notranslate"><span class="pre">load_target_data(...)</span></code>) for this to work.</p>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">BaseDriver.outputs</span></code> is a list of dicts, each of which is an
“output specification” which contains the information that will allow a
mapping from the target names (as stored in calibration_targets.py) to the
corresponding NetCDF output. Additional informations in the specification
are the resolutions desired and a type signifier allowing us to
differentiate between fluxes and pools, which is necessary for some summary
statistics that may be calculated later.</p>
<p>This list of output specifications will be used to setup the correct outputs
in each sample specific run folder as well as conveniences like naming
columns in output summary files.</p>
<p>Sets/Modifies: <code class="docutils literal notranslate"><span class="pre">self.outputs</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>target_names</strong> (<em>list of str</em>) – The list should be strings naming targets in the calibration_targets.py
file.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – If a requested target is not found in targets dict.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.ssrf_summary2csv">
<span class="sig-name descname"><span class="pre">ssrf_summary2csv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">list_of_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.ssrf_summary2csv" title="Permalink to this definition"></a></dt>
<dd><p>Transforms a list of dicts with output data into a csv.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>list_of_data</strong> (<em>list of dicts</em>) – List of dicts as produced by <code class="docutils literal notranslate"><span class="pre">summarize_ssrf(..)</span></code>. Keys should be
cmt, ncname, ctname, modeled_value, target_value and pft and compartment
when applicable</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data</strong> – data will be a string that is a csv file with column names being output
variable (with PFT and compartment if applicable) and data will be the
modeled value for that output. The csv will should have one header line
and one data line.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str, formatted csv file</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.ssrf_targets2csv">
<span class="sig-name descname"><span class="pre">ssrf_targets2csv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.ssrf_targets2csv" title="Permalink to this definition"></a></dt>
<dd><p>Write a nicely formatted csv file with the target values. The column names
are the NetCDF variable names with PFT and compartment if applicable. The
calibration target names (names that are used for target values in the
calibration_targets.py file) are included as a commented out line at the top
of the file.</p>
<p>Including the comment line with calibration target names precludes following
the API pattern of the ssrf_summary2csv(..) function, so here rather than
returing the csv string, we require a path name and we write data to the
file.</p>
<p>Writes file to <code class="docutils literal notranslate"><span class="pre">filename</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> (<em>list of dicts</em>) – <p>Something like this:</p>
<dl class="simple">
<dt>[ {‘cmt’: ‘CMT06’,</dt><dd><p>’ncname’: ‘INGPP’, ‘ctname’: ‘GPPAllIgnoringNitrogen’, ‘pft’: 0
‘modeled_value’: 8.8399451693811, ‘target_value’: 11.833, }, … ]</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.Sensitivity.Sensitivity.summarize_ssrf">
<span class="sig-name descname"><span class="pre">summarize_ssrf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_directory_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.Sensitivity.summarize_ssrf" title="Permalink to this definition"></a></dt>
<dd><p>Grabs the modeled data from the run and collates it into a list of dicts
that can then be easily transformed into other formats. The intention here
is to create a list of dicts that can be fed directly into a
<code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with labeled columns.</p>
<p>And there should be one dict in the list for each variable the outputs list.</p>
<p>NOTE: This function takes extract the data from the output netcdf files and
takes the mean over the last 10 timesteps!</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>output_directory_path</strong> (<em>str</em><em> (</em><em>path</em><em>)</em>) – Path to a Sample Specific Run Folder (ssrf).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p><strong>data</strong> – One dict for each output that is specified. The keys in the dicts will be
cmt, ncname, ctname, modeled_value, target_value and pft and compartment
when applicable. For example:</p>
<blockquote>
<div><dl class="simple">
<dt>{ ‘cmt’: ‘CMT06’,</dt><dd><p>’ncname’: ‘INGPP’, ‘ctname’: ‘GPPAllIgnoringNitrogen’,
‘modeled_value’: 6.743048039242422, ‘target_value’: 11.833, ‘pft’: 0 }</p>
</dd>
</dl>
</div></blockquote>
<p>There will be one dict in the returned list for each output variable.</p>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>[{…}, … {…}], list of dicts</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="drivers.Sensitivity.generate_lhc">
<span class="sig-prename descclassname"><span class="pre">drivers.Sensitivity.</span></span><span class="sig-name descname"><span class="pre">generate_lhc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_props</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.generate_lhc" title="Permalink to this definition"></a></dt>
<dd><p>Generate sample matrix using Latin Hyper Cube method.</p>
<p>Sample matrix will have one row for each “sample” of the
parameters. There will be one column for each parameter in
the <cite>param_props</cite> list.</p>
<dl>
<dt>For example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">generate_lhc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">... </span>  <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;rhq10&quot;</span><span class="p">,</span> <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cmax&quot;</span><span class="p">,</span> <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]}</span> <span class="p">])</span>
<span class="go">      rhq10       cmax</span>
<span class="go">0  0.419637  10.949468</span>
<span class="go">1  4.162081  13.456290</span>
<span class="go">2  2.168131  18.698548</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>N</strong> (<em>int</em>) – number of samples (rows) to create</p></li>
<li><p><strong>param_props</strong> (<em>list of dicts</em>) – Each item in <cite>param_props</cite> list will be a dictionary
with at least the following:
&gt;&gt;&gt; param_props = {
…   ‘name’: ‘cmax’,               # name in dvmdostem parameter file (cmt_*.txt)
…   ‘bounds’: [100.1, 105.1],     # the min and max values the parameter can have
… }</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>df</strong> – There will be one column for each parameter in the
<cite>param_props</cite> list and N rows (samples).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas.DataFrame, shape (N, len(param_props))</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="drivers.Sensitivity.generate_uniform">
<span class="sig-prename descclassname"><span class="pre">drivers.Sensitivity.</span></span><span class="sig-name descname"><span class="pre">generate_uniform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_props</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.generate_uniform" title="Permalink to this definition"></a></dt>
<dd><p>Generate sample matrix using uniform method.</p>
<p>Sample matrix will have one row for each “sample” of the
parameters. There will be one column for each parameter in
the <cite>param_props</cite> list.</p>
<dl>
<dt>For example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">generate_uniform</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">... </span>  <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;rhq10&quot;</span><span class="p">,</span> <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cmax&quot;</span><span class="p">,</span> <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]}</span> <span class="p">])</span>
<span class="go">      rhq10       cmax</span>
<span class="go">0  2.513395  10.514788</span>
<span class="go">1  1.393232  19.082659</span>
<span class="go">2  1.197809  11.448949</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>N</strong> (<em>int</em>) – number of samples (rows) to create</p></li>
<li><p><strong>param_props</strong> (<em>list of dicts</em>) – Each item in <cite>param_props</cite> list will be a dictionary
with at least the following:
&gt;&gt;&gt; param_props = {
…   ‘name’: ‘rhq10’,        # name in dvmdostem parameter file (cmt_*.txt)
…   ‘bounds’: [5.2, 6.4],   # the min and max values the parameter can have
… }</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>df</strong> – There will be one column for each parameter in the
<cite>param_props</cite> list and N rows (samples).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas.DataFrame, shape (N, len(param_props))</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="drivers.Sensitivity.log_wrapper">
<span class="sig-prename descclassname"><span class="pre">drivers.Sensitivity.</span></span><span class="sig-name descname"><span class="pre">log_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.log_wrapper" title="Permalink to this definition"></a></dt>
<dd><p>Print the <code class="docutils literal notranslate"><span class="pre">message</span></code> with the process name at the beginning.</p>
<p>Use via a context manager, for example:</p>
<blockquote>
<div></div></blockquote>
<p>To get something like this:</p>
<blockquote>
<div></div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="drivers.Sensitivity.make_col_name">
<span class="sig-prename descclassname"><span class="pre">drivers.Sensitivity.</span></span><span class="sig-name descname"><span class="pre">make_col_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.make_col_name" title="Permalink to this definition"></a></dt>
<dd><p>Make standardized column names for parameters.</p>
<p>Expects <code class="docutils literal notranslate"><span class="pre">pdict</span></code> to be a dictionary of items related to a parameter, e.g.:</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>col_name</strong> – A string to use for the sample_matrix column name. Should be simply the
parameter name for non-PFT parameters and for PFT parameters, the name
should be suffixe with _pftN where N is the PFT number.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="drivers.Sensitivity.params_from_seed">
<span class="sig-prename descclassname"><span class="pre">drivers.Sensitivity.</span></span><span class="sig-name descname"><span class="pre">params_from_seed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seedpath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pftnums</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percent_diffs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.Sensitivity.params_from_seed" title="Permalink to this definition"></a></dt>
<dd><p>Builds a list of “param specifications” from the data in the <cite>seedpath</cite> and
for params specified in <cite>params</cite> for the pfts specified in <cite>pftnums</cite> and the
Community specified in <cite>cmtnum</cite>. Sets bounds based on the intial values
found in the <cite>seedpath</cite> and according to the percent_diffs.</p>
<p>NOTE: What happens for negative numbers? Do the bounds need to be reversed?</p>
</dd></dl>

</section>
<section id="module-drivers.MadsTEMDriver">
<span id="drivers-madstemdriver"></span><h1>drivers.MadsTEMDriver<a class="headerlink" href="#module-drivers.MadsTEMDriver" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">drivers.MadsTEMDriver.</span></span><span class="sig-name descname"><span class="pre">MadsTEMDriver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#drivers.BaseDriver.BaseDriver" title="drivers.BaseDriver.BaseDriver"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseDriver</span></code></a></p>
<p>MadsTEMDriver class for controlling and running the driving the dvmdostem
model from a Julia script with the Mads package.</p>
<p>This class extends the functionality of the BaseDriver class and includes
methods for setting up the run directory, updating parameters, running the
model, and gathering model outputs.</p>
<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.clean">
<span class="sig-name descname"><span class="pre">clean</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.clean" title="Permalink to this definition"></a></dt>
<dd><p>Remove the entire tree at <cite>self.work_dir</cite>.</p>
<p>This function is NOT CAREFUL, so be careful using it!</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.fromfilename">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fromfilename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.fromfilename" title="Permalink to this definition"></a></dt>
<dd><p>Create an instance of BaseDriver from a configuration file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – The path to the configuration file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An instance of BaseDriver initialized with parameters from the
configuration file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#drivers.BaseDriver.BaseDriver" title="drivers.BaseDriver.BaseDriver">BaseDriver</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.gather_model_outputs">
<span class="sig-name descname"><span class="pre">gather_model_outputs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.gather_model_outputs" title="Permalink to this definition"></a></dt>
<dd><p>Gather and process model outputs for comparison with target data.</p>
<p>Migrated from TEM.py::get_calibration_outputs.py.</p>
<p>The implementation in TEM.py was tangled up with logic for loading target
data and included the unused calculation of “percent ecosystem contribution”
(pec) which can be used for weighting…but the pec was not being used in
this context, so it has been removed here. See util/qcal.py for an example
of its use.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>A list containing dictionaries with information about model outputs. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s1">&#39;cmt&#39;</span><span class="p">:</span> <span class="s1">&#39;CMT06&#39;</span><span class="p">,</span> <span class="s1">&#39;ctname&#39;</span><span class="p">:</span> <span class="s1">&#39;GPP&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">10.1</span><span class="p">,</span> <span class="s1">&#39;truth&#39;</span><span class="p">:</span> <span class="mf">11.83</span><span class="p">,</span> <span class="s1">&#39;pft&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;cmt&#39;</span><span class="p">:</span> <span class="s1">&#39;CMT06&#39;</span><span class="p">,</span> <span class="s1">&#39;ctname&#39;</span><span class="p">:</span> <span class="s1">&#39;GPP&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">29.05</span><span class="p">,</span> <span class="s1">&#39;truth&#39;</span><span class="p">:</span> <span class="mf">197.8</span><span class="p">,</span> <span class="s1">&#39;pft&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
<span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.load_target_data">
<span class="sig-name descname"><span class="pre">load_target_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ref_target_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.load_target_data" title="Permalink to this definition"></a></dt>
<dd><p>Load a set of target values from a calibration_targets.py file. When the
function is done, the targets will be available as a dictionary that is a
data member of the Driver object. There will be an
additional dict named <code class="docutils literal notranslate"><span class="pre">targets_meta</span></code> that has the metadata about the
targets, for example the corresponding NetCDF name, the units, etc.</p>
<p>Targets could also be referred to as “observations”. I.e. data that was
measured in the field and that model should be able to produce by
simulation.</p>
<p>This function reads the entire calibration_target.py file but extracts only
the targets for the CMTNUM of this driver object.</p>
<p>Note: This function loads executable code from an arbitrary loction which is
probably not ideal from a security standpoint. Maybe calibration_targets.py
should be re-facotred into a data file and a set of target utilities similar
to the parameters files.</p>
<p>Modifies/Sets: <code class="docutils literal notranslate"><span class="pre">self.targets</span></code>, <code class="docutils literal notranslate"><span class="pre">self.targets_meta</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ref_target_path</strong> (<em>str</em><em> (</em><em>path</em><em>)</em>) – A path to a folder containing a calibration_targets.py file.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – If cmtnum is not set or if there’s a problem loading targets.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.modeled_vec">
<span class="sig-name descname"><span class="pre">modeled_vec</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.modeled_vec" title="Permalink to this definition"></a></dt>
<dd><p>Return a flat list of the model output values.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.observed_vec">
<span class="sig-name descname"><span class="pre">observed_vec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'labeled'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.observed_vec" title="Permalink to this definition"></a></dt>
<dd><p>Return a list of the observation values (aka targets).</p>
<p>The target values are included in the model output data structures, and
could be accessed exactly like the <cite>modeled_vec()</cite> function but
if you have not yet run the model you don’t have outputs ready and
therefore can’t read them. There are cases where you would like to
see the target values without running the model, so we will assemble
them here from the <cite>self.targets</cite> data structure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>format</strong> (<em>{'labeled'</em><em>, </em><em>'flat'}</em>) – Choose the format that returned data will be in. ‘labeled’ data will be a
list of dicts that can be converted to Pandas DataFrame. ‘flat’ data will
return a flat list in the order:
<cite>[ pft0_leaf,pft0_stem,pft0_root, … pftN_leaf, pftN_stem, pftN_root ]</cite></p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>target_data</strong> – The target data, organized as specified with <cite>format</cite> parameter.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>iterable</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.params_vec">
<span class="sig-name descname"><span class="pre">params_vec</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.params_vec" title="Permalink to this definition"></a></dt>
<dd><p>Return a flat list of the parameter values.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.run" title="Permalink to this definition"></a></dt>
<dd><p>Run the model according to the setup.</p>
<p>Assumes everything is setup in the <code class="docutils literal notranslate"><span class="pre">run</span></code> subdirectory of <code class="docutils literal notranslate"><span class="pre">self.work_dir</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.run_wrapper">
<span class="sig-name descname"><span class="pre">run_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameter_vector</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.run_wrapper" title="Permalink to this definition"></a></dt>
<dd><p>Run the model using a vector of parameters and return model outputs.</p>
<p>Takes in a vector of parameters; uses the parameters to run the model
and returns a collection of outputs. Outputs are intended to be compared
to target data. So if you have 5 targets you are comparing to, you should
expect 5 output variables</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>parameter_vector</strong> (<em>list</em>) – A list of parameter values to use for the model run.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A collection of model outputs intended to be compared to target data.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.set_params_from_seed">
<span class="sig-name descname"><span class="pre">set_params_from_seed</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.set_params_from_seed" title="Permalink to this definition"></a></dt>
<dd><p>Sets up a list of dicts mapping parameter names to values….</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Assumes that various things have been setup:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">self.cmtnum</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.paramnames</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.pftnums</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self._seedpath</span></code></p></li>
</ul>
</div></blockquote>
</div>
<p>Analogous to <code class="docutils literal notranslate"><span class="pre">Sensitivity.params_from_seed(...)</span></code> but this one uses a
different name in the dict (‘vals’ vs ‘intial’) and this is setup as a
member function that modifies/updates a member variable (self.params)
whereas in Sensitivity, it is a stand alone module function… Would be
great to combine these…</p>
<p>Migrated directly from TEM.py::set_params(…)</p>
<p>This function simply modifies the objects params lookup structure. It does
not actually modify parameters in the run directory…</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.set_seed_path">
<span class="sig-name descname"><span class="pre">set_seed_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.set_seed_path" title="Permalink to this definition"></a></dt>
<dd><p>Set the seed path for the object.</p>
<p>Seed path is where the default parameter values for all the runs will be
read from. Subsequent steps may modify select parameters for individual
runs, but the original source values will be set from the seed path.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Should changing the seed path force a clean? If the seed path is set or
changed, this should probably trigger a re-build of all the working
directories…. or warn the user…?</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – The path to set as the seed path.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.set_work_dir">
<span class="sig-name descname"><span class="pre">set_work_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.set_work_dir" title="Permalink to this definition"></a></dt>
<dd><p>Set the working directory for the object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – The path to set as the working directory.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.setup_outputs">
<span class="sig-name descname"><span class="pre">setup_outputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.setup_outputs" title="Permalink to this definition"></a></dt>
<dd><p>Setup the driver’s list of output specifications based on the target
(observation) names.</p>
<p>The client must have already loaded the targets, i.e.
(<code class="docutils literal notranslate"><span class="pre">load_target_data(...)</span></code>) for this to work.</p>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">BaseDriver.outputs</span></code> is a list of dicts, each of which is an
“output specification” which contains the information that will allow a
mapping from the target names (as stored in calibration_targets.py) to the
corresponding NetCDF output. Additional informations in the specification
are the resolutions desired and a type signifier allowing us to
differentiate between fluxes and pools, which is necessary for some summary
statistics that may be calculated later.</p>
<p>This list of output specifications will be used to setup the correct outputs
in each sample specific run folder as well as conveniences like naming
columns in output summary files.</p>
<p>Sets/Modifies: <code class="docutils literal notranslate"><span class="pre">self.outputs</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>target_names</strong> (<em>list of str</em>) – The list should be strings naming targets in the calibration_targets.py
file.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – If a requested target is not found in targets dict.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.setup_run_dir">
<span class="sig-name descname"><span class="pre">setup_run_dir</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.setup_run_dir" title="Permalink to this definition"></a></dt>
<dd><p>Set up the run directory for the model using properties of the driver object
to control aspects of how the run directory is configured.</p>
<p>This method creates the working directory, adjusts the run mask for the
appropriate pixel, sets the output specification file, and adjusts
the configuration file.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.update_params">
<span class="sig-name descname"><span class="pre">update_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">junk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.update_params" title="Permalink to this definition"></a></dt>
<dd><p>Update the values in <code class="docutils literal notranslate"><span class="pre">self.params</span></code> with values in <code class="docutils literal notranslate"><span class="pre">vector</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This does not actually update anything the run directory. See the other
function, <code class="docutils literal notranslate"><span class="pre">write_params2rundir(...)</span></code> for that. Maybe these functions
should be combined? Is there ever a reason to update the internal data
structure (<code class="docutils literal notranslate"><span class="pre">self.params</span></code>) without writing the data to the run directory?</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vector</strong> (<em>list</em>) – A list of parameter values to update.</p></li>
<li><p><strong>junk</strong> (<em>None</em><em>, </em><em>optional</em>) – Ignored parameter. Provided for compatibility.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="drivers.MadsTEMDriver.MadsTEMDriver.write_params2rundir">
<span class="sig-name descname"><span class="pre">write_params2rundir</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.MadsTEMDriver.MadsTEMDriver.write_params2rundir" title="Permalink to this definition"></a></dt>
<dd><p>Update the parameters in the run directory to match those in
<code class="docutils literal notranslate"><span class="pre">self.params</span></code>.</p>
<p>This method iterates through the parameters in the internal params table and
updates the corresponding values in the run directory using the
<cite>pu.update_inplace</cite> function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-SA_post_hoc_analysis">
<span id="mads-calibration-sa-post-hoc-analysis"></span><h1>mads_calibration.SA_post_hoc_analysis<a class="headerlink" href="#module-SA_post_hoc_analysis" title="Permalink to this heading"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.calc_combined_score">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">calc_combined_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.calc_combined_score" title="Permalink to this definition"></a></dt>
<dd><p>Calculate a combination score using r^2, and normalized mse and mape.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.calc_correlation">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">calc_correlation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_matrix</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.calc_correlation" title="Permalink to this definition"></a></dt>
<dd><p>Generate a correlation matrix between parameters and model outputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sample_matrix</strong> (<em>pandas.DataFrame</em>) – with one row per sample, one column per parameter</p></li>
<li><p><strong>model_results</strong> (<em>pandas.DataFrame</em>) – with one row per sample, one column per output</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>corr_mp</strong> – One column for each parameter, one row for each model output.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.calc_metrics">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">calc_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.calc_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Calculate a bunch of sklearn regression metrics.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.equilibrium_check">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">equilibrium_check</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eq_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slope_lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.equilibrium_check" title="Permalink to this definition"></a></dt>
<dd><p>Calculates percentage of samples which pass user input (or default)
equilibrium test and plots a bar graph.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>eq_params</strong> (<em>Pandas DataFrame</em>) – equilibrium quality dataframe for a single target variable</p></li>
<li><p><strong>targets</strong> (<em>Pandas DataFrame</em>) – Used to read in target variable names</p></li>
<li><p><strong>cv_lim</strong> (<em>float</em>) – coefficient of variation threshold as a %</p></li>
<li><p><strong>p_lim</strong> (<em>float</em>) – p-value threshold as a %</p></li>
<li><p><strong>slope_lim</strong> (<em>float</em>) – slope threshold as a fraction of target variable</p></li>
<li><p><strong>Returns</strong> – <dl class="simple">
<dt>counts<span class="classifier">Pandas DataFrame</span></dt><dd><p>Pass / Fail percentage for each variable</p>
</dd>
<dt>eq_check<span class="classifier">Pandas DataFrame</span></dt><dd><p>Boolean for each variable comprising of cv, p, slope test</p>
</dd>
<dt>eq_data<span class="classifier">Pandas DataFrame</span></dt><dd><p>Boolean for each variable and each test for more thorough inspection</p>
</dd>
</dl>
</p></li>
<li><p><strong>image:</strong> (<em>..</em>) – /images/SA_post_hoc_analysis/eq_plot.png:</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.generate_ca_config">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">generate_ca_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.generate_ca_config" title="Permalink to this definition"></a></dt>
<dd><p>Maybe we should auto-generate the yaml config files?</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.load">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.load" title="Permalink to this definition"></a></dt>
<dd><p>Load up pandas.DataFrames for all the various things that you will want to
analyze. This includes the parameter properties used for the SA, the
sample matrix, the target data and the model results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – A file path to a directory that is expected to have the following files:
param_props.csv, sample_matrix.csv, targets.csv, results.csv.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>param_props, sample_matrix, targets, results</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.n_top_runs">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">n_top_runs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r2lim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.n_top_runs" title="Permalink to this definition"></a></dt>
<dd><p>Get the best runs measured using R^2, if N is present sort and return
N top runs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<em>pandas.DataFrame</em>) – One column for each output variable, one row for each sample run.</p></li>
<li><p><strong>targets</strong> (<em>pandas.DataFrame</em>) – One column for each output (target) variable, single row with target value.</p></li>
<li><p><strong>params</strong> (<em>pandas.DataFrame</em>) – One row for each of the selected runs, one column for each parameter.</p></li>
<li><p><strong>r2lim</strong> (<em>float</em>) – Lower R^2 limit for output.</p></li>
<li><p><strong>N</strong> (<em>integer</em><em>, </em><em>optional</em>) – Number of sorted results to return</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_params</strong> (<em>pandas.DataFrame</em>) – parameters returning variables above R^2 threshold from target value, sorted
top N number if None!=None</p></li>
<li><p><strong>best_results</strong> (<em>pandas.DataFrame</em>) – results above R^2 threshold from target value, sorted
top N number if None!=None</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.nitrogen_check">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">nitrogen_check</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">biome</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'boreal'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.nitrogen_check" title="Permalink to this definition"></a></dt>
<dd><p>Plots INGPP : GPP ratio to examine nitrogen limitation
and compares to expected ranges for boreal and tundra
ecosystems.</p>
<p>Note: this requires auxiliary variables INGPP, GPP, and
AVLN to be specified in the config file. If calib_mode is set
to GPPAllIgnoringNitrogen this will not produce meaningful
results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – Specifies path to sensitivity sample run directory</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None</em></p></li>
<li><p><em>.. image:: /images/SA_post_hoc_analysis/n-check-comp-plot.png</em></p></li>
<li><p><em>.. image:: /images/SA_post_hoc_analysis/n-check-barplot.png</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_boxplot">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_boxplot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_boxplot" title="Permalink to this definition"></a></dt>
<dd><p>Plots a box and whiskers for each column in <code class="docutils literal notranslate"><span class="pre">results</span></code>. Plots a dot for
each target value.</p>
<p>Useful for seeing if the range of model outputs produced by running each row
in the sample matrix contains the target values.</p>
<a class="reference internal image-reference" href="_images/results_boxplot.png"><img alt="_images/results_boxplot.png" src="_images/results_boxplot.png" style="width: 80%;" /></a>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<em>pandas.DataFrame</em>) – One column for each model ouput variable, one row for each run (sample)</p></li>
<li><p><strong>targets</strong> (<em>pandas.DataFrame</em>) – One column for each target (truth, or observation) value. One row.</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – Assumes False so plot will not be saved. If set to true it will plot
in current directory unless saveprefix is specified</p></li>
<li><p><strong>saveprefix</strong> (<em>str</em>) – A string that is prepended to the saved filename ‘results_boxplot.png’</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_corr_heatmap">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_corr_heatmap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_corr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_corr_heatmap" title="Permalink to this definition"></a></dt>
<dd><p>??? Write something…</p>
<img alt="_images/correlation_heatmap.png" src="_images/correlation_heatmap.png" />
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_equilibrium_metrics_boxplot">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_equilibrium_metrics_boxplot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eq_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slope_lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_equilibrium_metrics_boxplot" title="Permalink to this definition"></a></dt>
<dd><p>Plots equilibrium metrics against certain quality thresholds
for a target variable</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>eq_params</strong> (<em>Pandas DataFrame</em>) – equilibrium quality dataframe for a single target variable</p></li>
<li><p><strong>targets</strong> (<em>Pandas DataFrame</em>) – Used to read in target variable names</p></li>
<li><p><strong>cv_lim</strong> (<em>float</em>) – coefficient of variation threshold as a %</p></li>
<li><p><strong>p_lim</strong> (<em>float</em>) – p-value threshold as a %</p></li>
<li><p><strong>slope_lim</strong> (<em>float</em>) – slope threshold as a fraction of target variable</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – saves figure if True</p></li>
<li><p><strong>saveprefix</strong> (<em>string</em>) – path to use if saving is enabled</p></li>
<li><p><strong>Returns</strong> – None</p></li>
<li><p><strong>image:</strong> (<em>..</em>) – /images/SA_post_hoc_analysis/eq_metrics_boxplot.png:</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_equilibrium_metrics_scatter">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_equilibrium_metrics_scatter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eq_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slope_lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_equilibrium_metrics_scatter" title="Permalink to this definition"></a></dt>
<dd><p>Plots equilibrium metrics against certain quality thresholds
for a target variable</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>eq_params</strong> (<em>Pandas DataFrame</em>) – equilibrium quality dataframe for a single target variable</p></li>
<li><p><strong>targets</strong> (<em>Pandas DataFrame</em>) – Used to read in target variable names</p></li>
<li><p><strong>cv_lim</strong> (<em>float</em>) – coefficient of variation threshold as a %</p></li>
<li><p><strong>p_lim</strong> (<em>float</em>) – p-value threshold as a %</p></li>
<li><p><strong>slope_lim</strong> (<em>float</em>) – slope threshold as a fraction of target variable</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – saves figure if True</p></li>
<li><p><strong>saveprefix</strong> (<em>string</em>) – path to use if saving is enabled</p></li>
<li><p><strong>Returns</strong> – None</p></li>
<li><p><strong>image:</strong> (<em>..</em>) – /images/SA_post_hoc_analysis/eq_metrics_plot.png:</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_equilibrium_relationships">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_equilibrium_relationships</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_equilibrium_relationships" title="Permalink to this definition"></a></dt>
<dd><p>Plots equilibrium timeseries for target variables in output directory</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – specifies path to sensitivity sample run directory</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – saves figure if True</p></li>
<li><p><strong>saveprefix</strong> (<em>string</em>) – path to use if saving is enabled</p></li>
<li><p><strong>Returns</strong> – None</p></li>
<li><p><strong>image:</strong> (<em>..</em>) – /images/SA_post_hoc_analysis/eq_rel_plot.png:</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_match">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_match" title="Permalink to this definition"></a></dt>
<dd><p>Plot targets vs model outputs (results). Dashed diagonal is line of perfect
agreement between the model output and the targets. Plot dot or marker for
each model output. Targets are on the y axis, model outputs on the x axis.</p>
<p>There is a horizontal collection of markers for each column in results.
If the collection of markers crosses the dashed 1:1 line, then the model
is capable of producing target values somewhere in the sample set. If the
collection of markers for a given column (model output) is all to the left
of the 1:1 line, then the modeled values are all too low. If the collection of
markers is all to the right of the 1:1 line then the modeled values are too
high.</p>
<img alt="_images/one2one_match.png" src="_images/one2one_match.png" />
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<em>pandas.DataFrame</em>) – One row for each run (sample), one column for each model output variable.</p></li>
<li><p><strong>targets</strong> (<em>pandas.DataFrame</em>) – Single row, one column for each target (truth, or observation) value.</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – Assumes False so plot will not be saved. If set to true it will plot
in current directory unless saveprefix is specified</p></li>
<li><p><strong>saveprefix</strong> (<em>str</em>) – A string that is prepended to the saved filename ‘results_boxplot.png’</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_output_scatter">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_output_scatter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r2lim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rmselim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapelim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_output_scatter" title="Permalink to this definition"></a></dt>
<dd><p>Create subplots for each column in <code class="docutils literal notranslate"><span class="pre">results</span></code>. Each subplot shows
scatter plots of the output value on the Y axis and the sample # on the X
axis. The target value is shown as a dashed line.</p>
<p>Optionally, <code class="docutils literal notranslate"><span class="pre">results</span></code> may be limited by R^2, RMSE, and/or MAPE by providing
limits using r2lim, rmselim, and mapelim respectively.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Not sure if this approach of putting everything in one giant figure will
scale up with number of output variables very well…</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<em>pandas.DataFrame</em>) – One column for each output variable, one row for each sample run.</p></li>
<li><p><strong>targets</strong> (<em>pandas.DataFrame</em>) – One column for each output (target) variable, single row with target value.</p></li>
<li><p><strong>r2lim</strong> (<em>float</em><em>, </em><em>optional</em>) – Lower R^2 limit for output.</p></li>
<li><p><strong>rmselim</strong> (<em>float</em><em>, </em><em>optional</em>) – Upper RMSE limit for output.</p></li>
<li><p><strong>mapelim</strong> (<em>float</em><em>, </em><em>optional</em>) – Upper MAPE limit for output.</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – Assumes False so plot will not be saved. If set to true it will plot
in current directory unless saveprefix is specified</p></li>
<li><p><strong>saveprefix</strong> (<em>str</em>) – A prefix to be prepended to the saved file name ‘output_target_scatter.png’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None</em></p></li>
<li><p><em>.. image:: /images/SA_post_hoc_analysis/output_target_scatter.png</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_pft_matrix">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_pft_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_pft_matrix" title="Permalink to this definition"></a></dt>
<dd><p>Look at the model outputs and the parameters, and plot all parameters
against each variable for 10 potential pfts</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<em>pandas.DataFrame</em>) – One row per sample, one column per output.</p></li>
<li><p><strong>sample_matrix</strong> (<em>pandas.DataFrame</em>) – One row per sample, one column per parameter.</p></li>
<li><p><strong>targets</strong> (<em>pandas.DataFrame</em>) – One row with one column per target value.</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – Assumes False so plot will not be saved. If set to true it will plot
in current directory unless saveprefix is specified</p></li>
<li><p><strong>saveprefix</strong> (<em>str</em>) – A string that is prepended to the saved filename ‘{var}_pft_plot.pdf’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None</em></p></li>
<li><p><em>.. image::</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_r2_rmse">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_r2_rmse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_r2_rmse" title="Permalink to this definition"></a></dt>
<dd><p>Plot R^2 against RMSE as a scatter plot for all runs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<em>pandas.DataFrame</em>) – One row per sample, one column per output.</p></li>
<li><p><strong>sample_matrix</strong> (<em>pandas.DataFrame</em>) – One row per sample, one column per parameter.</p></li>
<li><p><strong>targets</strong> (<em>pandas.DataFrame</em>) – One row with one column per target value.</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – Assumes False so plot will not be saved. If set to true it will plot
in current directory unless saveprefix is specified</p></li>
<li><p><strong>saveprefix</strong> (<em>str</em>) – A string that is prepended to the saved filename ‘{var}_pft_plot.pdf’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None</em></p></li>
<li><p><em>.. image:: /images/SA_post_hoc_analysis/r2_mse_mape.png</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_relationships">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_relationships</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corr_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_relationships" title="Permalink to this definition"></a></dt>
<dd><p>Look at the model outputs and the parameters, calculate the corrleation
between the two, and then make one plot for each instance where the
correlation exceeds the threshold.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<em>pandas.DataFrame</em>) – One row per sample, one column per output.</p></li>
<li><p><strong>sample_matrix</strong> (<em>pandas.DataFrame</em>) – One row per sample, one column per parameter.</p></li>
<li><p><strong>targets</strong> (<em>pandas.DataFrame</em>) – One row with one column per target value.</p></li>
<li><p><strong>variables</strong> (<em>list</em><em>, </em><em>optional</em>) – Strings referencing variables of interest in results</p></li>
<li><p><strong>parameter</strong> (<em>list</em><em>, </em><em>optional</em>) – Strings referencing parameers of interest in sample_matrix</p></li>
<li><p><strong>corr_threshold</strong> (<em>float</em><em>, </em><em>optional</em>) – Lower threshold for correlation to plot</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – Assumes False so plot will not be saved. If set to true it will plot
in current directory unless saveprefix is specified
Saves all subplots (can be a lot) if != None</p></li>
<li><p><strong>saveprefix</strong> (<em>str</em>) – A string that is prepended to the saved filename ‘{var}-{parameters}.png’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None</em></p></li>
<li><p><em>.. image:: /images/INGPP_pft0-cmax_pft0-cmax_pft3.png</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.plot_spaghetti">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">plot_spaghetti</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saveprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.plot_spaghetti" title="Permalink to this definition"></a></dt>
<dd><p>Plots one line for each sample (row) in <code class="docutils literal notranslate"><span class="pre">results</span></code>. Plots targets as dots.
X axis of plot are for different columns in <code class="docutils literal notranslate"><span class="pre">results</span></code>. Makes 2 plots, the
right one uses a log scale for the y axis. The right plot also has a mean line
(blue).</p>
<p>Useful for seeing if the range of model outputs produced by running each row
in the sample matrix contains the target values.</p>
<img alt="_images/spaghetti_plot.png" src="_images/spaghetti_plot.png" />
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> (<em>pandas.DataFrame</em>) – One row for each run (sample), one column for each model output variable.</p></li>
<li><p><strong>targets</strong> (<em>pandas.DataFrame</em>) – Single row, one column for each target (truth, or observation) value.</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – Assumes False so plot will not be saved. If set to true it will plot
in current directory unless saveprefix is specified</p></li>
<li><p><strong>saveprefix</strong> (<em>str</em>) – A string that is prepended to the saved filename ‘spaghetti_plot.png’</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.prep_mads_distributions">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">prep_mads_distributions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fmt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.prep_mads_distributions" title="Permalink to this definition"></a></dt>
<dd><p>Gives you something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mads_paramdist</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">Uniform</span><span class="p">(</span>  <span class="mf">5.9117</span><span class="p">,</span>  <span class="mf">26.5927</span><span class="p">)</span>    <span class="c1"># cmax_pft0</span>
  <span class="o">-</span> <span class="n">Uniform</span><span class="p">(</span> <span class="mf">46.0129</span><span class="p">,</span> <span class="mf">113.4639</span><span class="p">)</span>    <span class="c1"># cmax_pft1</span>
  <span class="o">-</span> <span class="n">Uniform</span><span class="p">(</span> <span class="mf">11.7916</span><span class="p">,</span>  <span class="mf">77.5827</span><span class="p">)</span>    <span class="c1"># cmax_pft2</span>
</pre></div>
</div>
<p>From B. Maglio’s notebook.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> (<em>pandas.DataFrame</em>) – One row for each of the selected runs, one column for each parameter.
Column names are</p></li>
<li><p><strong>fmt</strong> (<em>str</em>) – A user supplied format string specification. Should be something that
you would find on the right side of the colon in an f string format spec,
for example something like: ‘8.3f’ or ‘3.5f’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>dists</strong> – A nicely formatted string with the distributions for each parameter that can be
pasted into the .yaml file for the next step.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.prep_mads_initial_guess">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">prep_mads_initial_guess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fmt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.prep_mads_initial_guess" title="Permalink to this definition"></a></dt>
<dd><p>Generate MADS initial guess string based on parameter ranges. The idea is that
the intial guess should be the mean of the parameter range. Gives you
a string like this:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mads_initialguess</span><span class="p">:</span>
  <span class="o">-</span> <span class="mf">16.252</span>  <span class="c1"># cmax_pft0</span>
  <span class="o">-</span> <span class="mf">79.738</span>  <span class="c1"># cmax_pft1</span>
  <span class="o">-</span> <span class="mf">44.687</span>  <span class="c1"># cmax_pft2</span>
</pre></div>
</div>
</div></blockquote>
<p>that is intended to be copied into your <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> config file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> (<em>pandas.DataFrame</em>) – A DataFrame containing parameter values.</p></li>
<li><p><strong>fmt</strong> (<em>str</em>) – A user supplied format string specification. Should be something that
you would find on the right side of the colon in an f string format spec,
for example something like: ‘8.3f’ or ‘3.5f’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>MADS initial guess string.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="SA_post_hoc_analysis.read_mads_iterationresults">
<span class="sig-prename descclassname"><span class="pre">SA_post_hoc_analysis.</span></span><span class="sig-name descname"><span class="pre">read_mads_iterationresults</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterationresults_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SA_post_hoc_analysis.read_mads_iterationresults" title="Permalink to this definition"></a></dt>
<dd><p>Parse a Mads .iterationresults file and return data as 3 python lists.</p>
<p>Example of the input file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OrderedCollections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="s2">&quot;cmax_pft0&quot;</span> <span class="o">=&gt;</span> <span class="mf">26.245</span><span class="p">,</span> <span class="s2">&quot;cmax_pft1&quot;</span> <span class="o">=&gt;</span> <span class="o">...</span> <span class="p">)</span>
<span class="n">OF</span><span class="p">:</span> <span class="mf">1.985656773338984e8</span>
<span class="k">lambda</span><span class="p">:</span> <span class="mf">4.0e9</span>
<span class="n">OrderedCollections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="s2">&quot;cmax_pft0&quot;</span> <span class="o">=&gt;</span> <span class="mf">26.245</span><span class="p">,</span> <span class="s2">&quot;cmax_pft1&quot;</span> <span class="o">=&gt;</span> <span class="o">...</span> <span class="p">)</span>
<span class="n">OF</span><span class="p">:</span> <span class="mf">1.6545342e4353453</span><span class="n">e6</span>
<span class="k">lambda</span><span class="p">:</span> <span class="mf">1.4e6</span>
</pre></div>
</div>
</dd></dl>

<p>These are general purpose utility scripts for working with <code class="docutils literal notranslate"><span class="pre">dvmdostem</span></code>.</p>
</section>
<section id="module-util.param">
<span id="util-param"></span><h1>util.param<a class="headerlink" href="#module-util.param" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="util.param.ParamUtilSpeedHelper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">ParamUtilSpeedHelper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.ParamUtilSpeedHelper" title="Permalink to this definition"></a></dt>
<dd><p>Experimenting with having an object oriented API so that we can
cache some data in the object. Will save lots of time for various
look up type functionality.</p>
<p>With param.py in general the idea has been to have it be flexible
with repsect to the location of the parameter files. But that makes
some operations expensive because the code is constantly having to
re-build lookup data structures to find parameter names or files.</p>
<p>With this object the idea is to set the parameter directory upon
instantiation, and build the lookup data structure. Then future
operations can use that cached structure.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">util.param</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">ParamUtilSpeedHelper</span><span class="p">(</span><span class="s2">&quot;/work/parameters&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psh</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">pname</span><span class="o">=</span><span class="s1">&#39;cmax&#39;</span><span class="p">,</span> <span class="n">cmtnum</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">pftnum</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">with_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">13.45</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="util.param.ParamUtilSpeedHelper.get_value">
<span class="sig-name descname"><span class="pre">get_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pftnum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">with_metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.ParamUtilSpeedHelper.get_value" title="Permalink to this definition"></a></dt>
<dd><p>Look up the parameter value by name for given CMT and PFT.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pname</strong> (<em>str</em>) – Name of parameter as found in dvmdostem parameter files.</p></li>
<li><p><strong>cmtnum</strong> (<em>int</em>) – The number of the community type to grab data from.</p></li>
<li><p><strong>pftnum</strong> (<em>int</em>) – The PFT of the data to grab (for PFT parameters), None (default)
for non-pft parameters.</p></li>
<li><p><strong>with_metadata</strong> (<em>bool</em>) – (not implemented yet) flag for returning just the raw data or
a package with more metadata (e.g. param directory, filename, etc)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>v</strong> – The parameter value, or if <cite>with_metadata=True</cite>, a dict with more
info.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="util.param.ParamUtilSpeedHelper.list_non_pft_params">
<span class="sig-name descname"><span class="pre">list_non_pft_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.ParamUtilSpeedHelper.list_non_pft_params" title="Permalink to this definition"></a></dt>
<dd><p>Gets a listing of all non-PFT parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cmtnum</strong> (<em>int</em>) – The CMT number to read from.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>s</strong> – A formatted string of all non-PFT parameters, (i.e. soil params)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="util.param.ParamUtilSpeedHelper.list_params">
<span class="sig-name descname"><span class="pre">list_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pftnum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.ParamUtilSpeedHelper.list_params" title="Permalink to this definition"></a></dt>
<dd><p>Builds and returns a formatted string listing all the
parameters for a given CMT and PFT.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cmtnum</strong> (<em>int</em>) – The community type number to list parameters for.</p></li>
<li><p><strong>pftnum</strong> (<em>int</em>) – The PFT number to list parameters for.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>s</strong> – A formatted string listing all the parameters for a given CMT and PFT.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.build_param_lookup">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">build_param_lookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.build_param_lookup" title="Permalink to this definition"></a></dt>
<dd><p>Builds a lookup table, mapping file names to lists of
parameters (separate lists for PFT and non PFT params).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>pdir</strong> (<em>str Path to a folder of parameter files.</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p><strong>lu</strong> – A dictionary mapping file names to lists of parameters (pft and non-pft)
e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lu</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;cmt_calparbgc.txt&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;non_pft_params&#39;</span><span class="p">:[</span><span class="s1">&#39;kdcsoma&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="s1">&#39;pft_params&#39;</span><span class="p">:[</span><span class="s1">&#39;cmax&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">},</span>
  <span class="s1">&#39;cmt_bgcsoil.txt&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;non_pft_params&#39;</span><span class="p">:[</span><span class="s1">&#39;kdcsoma&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="s1">&#39;pft_params&#39;</span><span class="p">:[]</span>
  <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.cmdline_define">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">cmdline_define</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#util.param.cmdline_define" title="Permalink to this definition"></a></dt>
<dd><p>Define the command line interface and return the parser object.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.cmdline_parse">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">cmdline_parse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">argv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.cmdline_parse" title="Permalink to this definition"></a></dt>
<dd><p>Define and parse the command line interface.</p>
<p>When argv is None, the parser will evaluate sys.argv[1:]</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>args</strong> – A Namespace object with all the arguments and associated values.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Namespace</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.cmtdatablock2dict">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">cmtdatablock2dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cmtdatablock</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.cmtdatablock2dict" title="Permalink to this definition"></a></dt>
<dd><p>Converts a “CMT datablock” (list of strings) into a dict structure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cmtdatablock</strong> (<em>[</em><em>str</em><em>, </em><em>str</em><em>, </em><em>...</em><em>]</em>) – A list of strings (with new lines) holding parameter data for a CMT.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>cmtdict</strong> – A multi-level dict mapping names (deduced from comments) to parameter
values.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.comment_splitter">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">comment_splitter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.comment_splitter" title="Permalink to this definition"></a></dt>
<dd><p>Splits a string into data before comment and after comment.</p>
<p>The comment delimiter (‘//’) will be included in the after component.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>line</strong> (<em>str</em>) – A string representing the line of data. May or may not contain the comment
delimiter.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple containing the “before comment” string, and the “after comment”
string. The “after commnet” string will include the comment charachter.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>(str, str) - Tuple of strings.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.compare_CMTs">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">compare_CMTs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fileA</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnumA</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fileB</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnumB</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_formatting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.compare_CMTs" title="Permalink to this definition"></a></dt>
<dd><p>Compares the specified CMT data blocks in each file line by line, prints
“Match” if the lines are the same, otherwise print the lines for visual
comparison.</p>
<p>By running the datablocks thru the format function, we can compare on values
and ignore whitespace/formatting differences.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fileA</strong> (<em>str</em>) – Path to file for comparison.</p></li>
<li><p><strong>cmtnumA</strong> (<em>int</em>) – Number of CMT for comparison.</p></li>
<li><p><strong>fileB</strong> (<em>str</em>) – Path to file for comparison.</p></li>
<li><p><strong>cmtnumB</strong> (<em>int</em>) – Number of CMT for comparison.</p></li>
<li><p><strong>ignore_formatting</strong> (<em>bool</em>) – When True (default) it is easy to see how the numbers differ. When this
setting is False, lines with different formatting will not match, i.e.
0.0 and  0.000 will show up as different.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.converter">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">converter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.converter" title="Permalink to this definition"></a></dt>
<dd><p>Convert data to float type for printing. Converts empty string to 0.0</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<em>anything</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>If x castable to a float, a float is returned. If x is an empty string, 0.0
is returned. Otherwise x is returned un-modified.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.csv2fwt_v1">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">csv2fwt_v1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">csv_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'../parameters'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_targets</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.csv2fwt_v1" title="Permalink to this definition"></a></dt>
<dd><p>Convert from csv parameter files to fixed width text format.</p>
<p>Uses csv_v1_specification().</p>
<p>Unrefined function that depends on the csv file being
appropriately formatted in a variety of ways, including at least:</p>
<blockquote>
<div><ul class="simple">
<li><p>consistent pft names</p></li>
<li><p>all variables present</p></li>
<li><p>calibration targets variables for leaf/stem/roots being named as follows
- VegCarbon:Leaf, etc
- VegStructuralNitrogen:Leaf, etc</p></li>
<li><p>PFT names &lt;= 12 characters long</p></li>
<li><p>consistent CMT names</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>csv_file</strong> (<em>string</em><em>, </em><em>path</em>) – Path to an input csv file to convert.</p></li>
<li><p><strong>ref_directory</strong> (<em>string</em><em>, </em><em>path</em>) – Path to a folder containing parameter files to be used as reference for
formatting the resulting fixed width data.</p></li>
<li><p><strong>ref_targets</strong> (<em>string</em><em>, </em><em>path</em>) – Path to a calibration_targets.py file that will be used for reference in
formatting the resulting data.</p></li>
<li><p><strong>overwrite_files</strong> (<em>bool</em>) – (experimental) Flag for determining whether to print results to stdout
(default) or to overwrite the data in the reference files. May not work if
the CMT number in the csv file is not present in the reference files.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Returns zero upon successful completion.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.csv_v0_find_section_starts">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">csv_v0_find_section_starts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.csv_v0_find_section_starts" title="Permalink to this definition"></a></dt>
<dd><p>Gets the starting index and name for sections of data in a specially formatted csv file.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 0.6.1: </span><cite>csv_v0</cite> format will be removed in later versions!</p>
</div>
<p>Assumes that <cite>data</cite> is a list of lines read from a csv file. See help
(docstring) for csv_v0_specification().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> (<em>list of strings</em><em>, </em><em>required</em>) – Assumed to be a list generated by reading a csv file that is
formatted as in csv_v0_specification.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of tuples, where the first item in the tuple is the index in the
csv file where the section starts, and the second item in the tuple is the
text name for the section, as read from the file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.csv_v0_get_pftnames">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">csv_v0_get_pftnames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.csv_v0_get_pftnames" title="Permalink to this definition"></a></dt>
<dd><p>Retrieves PFT names from a specially formatted csv file.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 0.6.1: </span><cite>csv_v0</cite> format will be removed in later versions!</p>
</div>
<p>Assumes that <cite>data</cite> is a list of lines read from a csv file that
is formatted according to the csv_v0_specification. See help for the
csv_v0_specification() function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> (<em>list of strings</em><em>, </em><em>required</em>) – Assumed to be a list generated by reading a csv file that is
formatted as described above.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of pft names read from the incoming data.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.csv_v0_get_section">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">csv_v0_get_section</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.csv_v0_get_section" title="Permalink to this definition"></a></dt>
<dd><p>Extracts a section of block of data from a specially formatted csv file.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 0.6.1: </span><cite>csv_v0</cite> format will be removed in later versions!</p>
</div>
<p>Assumes that <cite>data</cite> is a list of lines read from a csv file. See help
(the docstring) for the csv_v0_specification() function to get more details
on how the csv file should be setup.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>list of strings</em><em>, </em><em>required</em>) – Assumed to be a list generated by reading a csv file that is formatted as
described in the docstring for csv_v0_specification()</p></li>
<li><p><strong>start</strong> – The index in the <cite>data</cite> list where the section starts.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The list of lines (rows) from <cite>data</cite> that belongs to a section or block.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.csv_v0_specification">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">csv_v0_specification</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#util.param.csv_v0_specification" title="Permalink to this definition"></a></dt>
<dd><p>Specification for csv files that hold parameter data.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 0.6.1: </span><cite>csv_v0</cite> format will be removed in later versions!</p>
</div>
<p>This csv format is intended to be used as a bridge between Excel
and the dvmdostem space delimited parameter files. Expected usage: A user
maintains or develops a spreadsheet with parameter data. Then user exports
this spreadsheet to csv file. The utility functions in this script can then
be used to parse the csv file and re-format the data as space delimited
text that can be copied into dvmdostem parameter files.</p>
<p>The csv file should be setup as follows:</p>
<ul class="simple">
<li><p>The csv file must have blank rows (lines) separating each section, or block
of data. Generally each block of data will be intended for a different parameter
file, i.e. cmt_envcanopy.txt, etc.</p></li>
<li><p>Each section must start with a row that has all CAPS text in the first column
and no data in the subsequent columns.</p></li>
<li><p>There must be a row in the file with ‘pft name’ in the first column followed
by names for each PFT in the subsequent columns. These names will be applied
to all the sections of data in the file.</p></li>
<li><p>There must not be more than 10 PFT columns.</p></li>
</ul>
<p>CAVEATS: PFT names will be converetd to CamelCase, comments
will not be preserved or added to the file, the CMT number won’t be filled
out, and no verification is done to see if there is a conflicting CMT number in
any existing parameter files.</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat example.csv
,,,,
pft name,EVR TREE,DEC SHRUB,DEC TREE,MOSS
,,,,
CALIBRATION TARGETS,,,,
GPPAllIgnoringNitrogen,306.07,24.53,46.53,54.20
NPPAllIgnoringNitrogen,229.91,18.42,34.98,40.65
NPPAll,153.03,12.26,23.26,27.1
,,,,
BCGVEGETATION,,,,
kc,400,400,400,400
ki,75,75,75,75
tmin,-1,-1,-1,-1
toptmin,15,15,15,15
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.csv_v1_find_section_indices">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">csv_v1_find_section_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">csv_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.csv_v1_find_section_indices" title="Permalink to this definition"></a></dt>
<dd><p>Parses a csv file and returns the starting and ending indices for each
section in the file.</p>
<p>Uses csv_v1_specification().</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>sections</strong> – Mapping of section names to a pair of ints representing the start and end
indices of the section, for example:
{‘meta’:(0,5), ‘pft’:(8,25), ‘nonpft’:(25,35)}</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.csv_v1_read_section">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">csv_v1_read_section</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.csv_v1_read_section" title="Permalink to this definition"></a></dt>
<dd><p>Write this…</p>
<p>Uses csv_v1_specification().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>list</em>) – The list of lines of a specially formatted csv file.</p></li>
<li><p><strong>bounds</strong> (<em>tuple</em>) – Pair of ints representing the starting and ending indices of a section.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>A list of dicts produced by csv.DictReader, one key for each column name.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.csv_v1_specification">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">csv_v1_specification</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#util.param.csv_v1_specification" title="Permalink to this definition"></a></dt>
<dd><p>Specification for v1 csv files for holding parameter data.</p>
<p>Each csv file will hold the data for one Community Type (CMT). As such the csv
file will be broken into sections to accomodate the different number of
columns in different sections. The sections of the file will be:</p>
<blockquote>
<div><ul class="simple">
<li><p>a metadata section,</p></li>
<li><p>a section for PFT specific parameters, and</p></li>
<li><p>a section for non-PFT parameters.</p></li>
</ul>
</div></blockquote>
<p>Each section will begin with a header line that describes the columns.</p>
<p>The header for the metadata will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span><span class="p">,</span><span class="n">cmtkey</span><span class="p">,</span><span class="n">cmtname</span><span class="p">,</span><span class="n">comment</span>
</pre></div>
</div>
<p>The header for the PFT section will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="n">units</span><span class="p">,</span><span class="n">description</span><span class="p">,</span><span class="n">comment</span><span class="p">,</span><span class="n">refs</span>
</pre></div>
</div>
<p>The header for the non-PFT section will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">units</span><span class="p">,</span><span class="n">description</span><span class="p">,</span><span class="n">comment</span><span class="p">,</span><span class="n">refs</span>
</pre></div>
</div>
<p>Each section will end with two consecutive blank lines.</p>
<p>Note that csv files prepared from different spreadsheet programs may have
different treatment regarding blank lines and rows with varying numbers of
columns. Many programs will produce files with lots of extra commas
deliniating empty columns. Some of these extraneous commas have been omitted
in the sample below.</p>
<p>Example data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># dvmdostem parameters: v0.5.6-178-g4cdb7c34</span>
<span class="c1"># cmtnumber: 22</span>
<span class="c1"># cmtname: Single PFT Alpine Tussock Tundra</span>
<span class="c1"># cmtdescription: alpine tussock tundra for Interior Alaska ....</span>
<span class="c1"># calibration site: The sentinel site used ....</span>
<span class="c1"># calibration notes: Calibration conducted manually by Joy ...</span>
<span class="c1"># references file: refs.bib</span>
<span class="c1">#</span>
<span class="c1"># To convert this file back to fixed width text for use with dvmdostem</span>
<span class="c1"># see the util.param.csv2fwt_v1() function.</span>
<span class="c1">#</span>
<span class="n">file</span><span class="p">,</span><span class="n">cmtkey</span><span class="p">,</span><span class="n">cmtname</span><span class="p">,</span><span class="n">comment</span><span class="p">,,,,,,,,,,,,</span>
<span class="o">../</span><span class="n">parameters</span><span class="o">/</span><span class="n">cmt_bgcvegetation</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span><span class="n">CMT22</span><span class="p">,</span><span class="n">Single</span> <span class="n">PFT</span> <span class="n">Alpine</span> <span class="n">Tussock</span> <span class="n">Tundra</span><span class="p">,,,,,,,,,,,,,</span>
<span class="o">../</span><span class="n">parameters</span><span class="o">/</span><span class="n">cmt_dimvegetation</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span><span class="n">CMT22</span><span class="p">,</span><span class="n">Single</span> <span class="n">PFT</span> <span class="n">Alpine</span> <span class="n">Tussock</span> <span class="n">Tundra</span><span class="p">,,,,,,,,,,,,,</span>
<span class="p">,,,,,,,,,,,,,,,</span>
<span class="p">,,,,,,,,,,,,,,,</span>
<span class="n">file</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="n">units</span><span class="p">,</span><span class="n">description</span><span class="p">,</span><span class="n">comment</span><span class="p">,</span><span class="n">refs</span>
<span class="o">../</span><span class="n">calibration</span><span class="o">/</span><span class="n">calibration_targets</span><span class="o">.</span><span class="n">py</span><span class="p">,</span><span class="n">PFTNames</span><span class="p">,</span><span class="n">ecosystem</span><span class="p">,</span><span class="n">pft1</span><span class="p">,</span><span class="n">pft2</span><span class="p">,</span><span class="n">pft3</span><span class="p">,</span><span class="n">pft4</span><span class="p">,</span><span class="n">pft5</span><span class="p">,</span><span class="n">pft6</span><span class="p">,</span><span class="n">pft7</span><span class="p">,</span><span class="n">pft8</span><span class="p">,</span><span class="n">pft9</span><span class="p">,,,,</span>
<span class="o">../</span><span class="n">calibration</span><span class="o">/</span><span class="n">calibration_targets</span><span class="o">.</span><span class="n">py</span><span class="p">,</span><span class="n">VegCarbon</span><span class="p">:</span><span class="n">Leaf</span><span class="p">,</span><span class="mf">320.2073015</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,,,,</span>
<span class="o">../</span><span class="n">calibration</span><span class="o">/</span><span class="n">calibration_targets</span><span class="o">.</span><span class="n">py</span><span class="p">,</span><span class="n">VegCarbon</span><span class="p">:</span><span class="n">Root</span><span class="p">,</span><span class="mf">480.9949012</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,,,,</span>
<span class="p">,,,,,,,,,,,,,,,</span>
<span class="p">,,,,,,,,,,,,,,,</span>
<span class="n">file</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">units</span><span class="p">,</span><span class="n">description</span><span class="p">,</span><span class="n">comment</span><span class="p">,</span><span class="n">refs</span><span class="p">,,,,,,,,,</span>
<span class="o">../</span><span class="n">calibration</span><span class="o">/</span><span class="n">calibration_targets</span><span class="o">.</span><span class="n">py</span><span class="p">,</span><span class="n">AvailableNitrogenSum</span><span class="p">,</span><span class="mf">1.7</span><span class="p">,,,,,,,,,,,,,</span>
<span class="o">../</span><span class="n">calibration</span><span class="o">/</span><span class="n">calibration_targets</span><span class="o">.</span><span class="n">py</span><span class="p">,</span><span class="n">MossDeathC</span><span class="p">,</span><span class="mi">0</span><span class="p">,,,,,,,,,,,,,</span>
<span class="o">../</span><span class="n">parameters</span><span class="o">/</span><span class="n">cmt_bgcsoil</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span><span class="n">fnloss</span><span class="p">,</span><span class="mi">0</span><span class="p">,,</span>  <span class="n">fraction</span> <span class="n">N</span> <span class="n">leaching</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">when</span> <span class="n">drainage</span> <span class="n">occurs</span><span class="p">,,,,,,,,,,,</span>
<span class="o">../</span><span class="n">parameters</span><span class="o">/</span><span class="n">cmt_bgcsoil</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span><span class="n">fsompr</span><span class="p">,</span><span class="mf">0.611</span><span class="p">,,,,,,,,,,,,,</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.detect_block_with_pft_info">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">detect_block_with_pft_info</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cmtdatablock</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.detect_block_with_pft_info" title="Permalink to this definition"></a></dt>
<dd><p>Inspects a block of CMT data and trys to figure out if it is PFT data or not.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cmtdatablock</strong> (<em>list of strings</em>) – A list of strings representing a datablock of dvmdostem parameter data.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>result</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.enforce_initvegc_split">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">enforce_initvegc_split</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">aFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.enforce_initvegc_split" title="Permalink to this definition"></a></dt>
<dd><p>Makes sure that the ‘cpart’ compartments variables match the proportions
set in initvegc variables in a cmt_bgcvegetation.txt file.</p>
<p>The initvegc(leaf, wood, root) variables in cmt_bgcvegetation.txt are the
measured values from literature. The cpart(leaf, wood, root) variables, which
are in the same file, should be set to the fractional make up of the the
components. So if the initvegc values for l, w, r are 100, 200, 300, then the
cpart values should be 0.166, 0.33, and 0.5. It is very easy for these values
to get out of sync when users manually update the parameter file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>aFile</strong> (<em>str</em>) – Path to a parameter file to work on. Must have bgcvegetation.txt in the name
and must be a ‘bgcvegetation’ parameter file for this function to make sense
and work.</p></li>
<li><p><strong>cmtnum</strong> (<em>int</em>) – The community number in the file to work on.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>d</strong> – A CMT data dictionary with the updated cpart values.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.error_exit">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">error_exit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">linenumber</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.error_exit" title="Permalink to this definition"></a></dt>
<dd><p>Prints and error message and exits.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fname</strong> (<em>string</em><em>, </em><em>required</em>) – The path to the offending file.</p></li>
<li><p><strong>msg</strong> (<em>string</em><em>, </em><em>required</em>) – A message or note to tbe printed.</p></li>
<li><p><strong>linenumber</strong> (<em>int</em><em>, </em><em>optional</em>) – The problematic line in the offending file.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.find_cmt_start_idx">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">find_cmt_start_idx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtkey</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.find_cmt_start_idx" title="Permalink to this definition"></a></dt>
<dd><p>Finds the starting index for a CMT data block in a list of lines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>[</em><em>str</em><em>, </em><em>str</em><em>, </em><em>...</em><em>]</em>) – A list of strings (maybe from a parameter file)</p></li>
<li><p><strong>cmtkey</strong> (<em>str</em>) – A a CMT code string like ‘CMT05’ to search for in the list.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The first index in the list where the CMT key is found. If key is not found
returns None.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.format_CMTdatadict">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">format_CMTdatadict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.format_CMTdatadict" title="Permalink to this definition"></a></dt>
<dd><p>Format a block of CMT data.</p>
<p><cite>dd</cite> : dict containing parameter names and values for a CMT.</p>
<p><cite>refFile</cite> : str with a path to a file that should be used for reference
in formatting the output.</p>
<p><cite>format</cite> : str (optional) specifying which format to return. Defaults to None.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p><strong>data</strong> – A list of strings that are formatted with fixed width columns, 12 chars
wide, with 6 places after the decimal, something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">CMT05</span> <span class="o">//</span> <span class="n">Tussock</span> <span class="n">Tundra</span>  <span class="o">...</span>
<span class="o">//</span>    <span class="n">Betula</span>       <span class="n">Decid</span><span class="o">.</span>   <span class="o">...</span>
  <span class="mf">400.000000</span>   <span class="mf">400.000000</span>   <span class="o">...</span>
   <span class="mf">75.000000</span>    <span class="mf">75.000000</span>   <span class="o">...</span>
   <span class="o">-</span><span class="mf">5.000000</span>    <span class="o">-</span><span class="mf">5.000000</span>   <span class="o">...</span>
<span class="o">...</span>
</pre></div>
</div>
</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>[str, str, …]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.format_section_csv_v0">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">format_section_csv_v0</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">section_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.format_section_csv_v0" title="Permalink to this definition"></a></dt>
<dd><p>Prints data (presumably from csv file) to dvmdostem space delimited parameter format.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 0.6.1: </span><cite>csv_v0</cite> format will be removed in later versions!</p>
</div>
<p>No effort is made to standardize the variable names or comments in the resulting
block. Used a fixed width column, space delimited.</p>
<p>See the help for csv_v0_specification() function to find more info on how the
csv file should be formatted.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>section_data</strong> (<em>list</em>) – Assumed to be a list of lines for one section of data read from a csv file. The csv
file must be formatted as described in the docstring for csv_v0_specification().</p></li>
<li><p><strong>full_data</strong> (<em>list</em>) – Assumed to be a list of lines of all the data read from a csv file. The csv
file must be formatted as described in the docstring for csv_v0_specification().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A formatted string with space delimited parameter data.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.fwt2csv_v1">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">fwt2csv_v1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">param_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">req_cmts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.fwt2csv_v1" title="Permalink to this definition"></a></dt>
<dd><p>Convert from dvmdostem fixed width text (fwt) format to CSV (comma separated
values), version 1.</p>
<p>Writes one file for each CMT, with all parameters from the fixed width
files. The output files will be named like “SAMPLE_CMT_01.csv”, etc and
will be written in your current working directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>param_dir</strong> (<em>string</em><em>, </em><em>path</em>) – Path to a directory of parameter files to convert.</p></li>
<li><p><strong>req_cmts</strong> (<em>list of ints</em><em> or </em><em>string</em>) – A list of the requested CMTs (numbers) or the string ‘all’.</p></li>
<li><p><strong>targets_path</strong> (<em>string</em><em>, </em><em>path</em>) – Path to a targets file to convert.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.generate_reference_order">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">generate_reference_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">aFile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.generate_reference_order" title="Permalink to this definition"></a></dt>
<dd><p>Lists order that variables should be in in a parameter file based on CMT 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>aFile</strong> (<em>str</em>) – The file to use as a base.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ref_order</strong> – A list of strings containing the variable names, parsed from the input file
in the order they appear in the input file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>[str, str, …]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.get_CMT_datablock">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">get_CMT_datablock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">afile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.get_CMT_datablock" title="Permalink to this definition"></a></dt>
<dd><p>Search file, returns the first block of data for one CMT as a list of strings.
Ignores empty lines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>afile</strong> (<em>str</em>) – Path to a file to search.</p></li>
<li><p><strong>cmtnum</strong> (<em>int</em><em> or </em><em>str</em>) – The CMT number to search for. Converted (internally) to the CMT key.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data</strong> – A list of strings, one item for each line in the CMT’s datablock.
Each string will have a newline charachter in it.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>[str, str, …]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.get_CMTs_in_file">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">get_CMTs_in_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">aFile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.get_CMTs_in_file" title="Permalink to this definition"></a></dt>
<dd><p>Gets a list of the CMTs found in a file.</p>
<p>Looks at all lines in the file and considers any commented line with the
‘CMT’ as the first non-whitespace charachters after the initial comment
symbol to be a CMT definition line. Parses this line and sets the following
keys in a dict: cmtkey, cmtnum, cmtname, cmtcomments</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>aFile</strong> (<em>string</em><em>, </em><em>required</em>) – The path to a file to read.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of dicts with info about the CMTs found in a file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list of dicts</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.get_available_CMTs">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">get_available_CMTs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.get_available_CMTs" title="Permalink to this definition"></a></dt>
<dd><p>Return list of available CMT numbers in directory.</p>
<p>Only returns CMTs that are defined in all files.</p>
<dl class="simple">
<dt>Assumptions:</dt><dd><ul class="simple">
<li><p>nothing else in <cite>pdir</cite></p></li>
<li><p>parameter files in <cite>pdir</cite> are valid</p></li>
<li><p>CMTs not defined twice in one file</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>pdir</strong> (<em>str</em>) – Path to directory of dvmdostem parameter files.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>x</strong> – A list of all the CMTs available in <cite>pdir</cite>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list of ints</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.get_datablock_pftkeys">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">get_datablock_pftkeys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dd</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.get_datablock_pftkeys" title="Permalink to this definition"></a></dt>
<dd><p>Returns a sorted list of the pft keys present in a CMT data dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dd</strong> (<em>dict</em>) – A CMT data dictionary (as might be created from cmtdatablock2dict(..)).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A sorted list of the keys present in dd that contain the string ‘pft’.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>[str, str, … ] - list of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.isCMTkey">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">isCMTkey</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.isCMTkey" title="Permalink to this definition"></a></dt>
<dd><p>Function for testing validity of a CMT key specifier.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<em>any</em>) – Something to be tested for being a (str) CMT key, i.e. somehting like
<cite>‘CMT01’</cite>.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">isCMTkey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cmt04&#39;</span><span class="p">,</span> <span class="s1">&#39;cmt999&#39;</span><span class="p">,</span> <span class="s1">&#39;CMt56&#39;</span><span class="p">,</span> <span class="s1">&#39;CMT4y6&#39;</span><span class="p">,</span> <span class="s1">&#39;CMT00&#39;</span><span class="p">)]</span>
<span class="go">[True, False, True, False, True]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">isCMTkey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cmt00&#39;</span><span class="p">,</span> <span class="s1">&#39;cmt1234&#39;</span><span class="p">,</span> <span class="s1">&#39;c mtx&#39;</span><span class="p">,</span> <span class="s1">&#39; cmt09&#39;</span><span class="p">,</span> <span class="s1">&#39;cmt04 &#39;</span><span class="p">,)]</span>
<span class="go">[True, False, False, True, True]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">isCMTkey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cmt 23&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;04&#39;</span><span class="p">,</span> <span class="s1">&#39;0004&#39;</span><span class="p">,</span> <span class="s1">&#39;cmt4&#39;</span><span class="p">)]</span>
<span class="go">[True, False, False, False, False]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.isParamFile">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">isParamFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.isParamFile" title="Permalink to this definition"></a></dt>
<dd><p>Check to see if a file is likely a dvmdostem parameter file.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.is_CMT_divider_line">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">is_CMT_divider_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.is_CMT_divider_line" title="Permalink to this definition"></a></dt>
<dd><p>Checks to see if a line is one of the comment lines we use to divide
CMT data blocks in parameter files, e.g. // ======</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.keyFnum">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">keyFnum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.keyFnum" title="Permalink to this definition"></a></dt>
<dd><p>Given a number</p>
<p>Examples:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keyFnum</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="go">&#39;CMT04&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keyFnum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&#39;CMT00&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keyFnum</span><span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>
<span class="go">&#39;CMT04&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keyFnum</span><span class="p">(</span><span class="s1">&#39;000&#39;</span><span class="p">)</span>
<span class="go">&#39;CMT00&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keyFnum</span><span class="p">(</span><span class="s1">&#39;101&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">Out of range 0 &lt;= x &lt;= 99</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keyFnum</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">Out of range 0 &lt;= x &lt;= 99</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keyFnum</span><span class="p">(</span><span class="s1">&#39;  5 &#39;</span><span class="p">)</span>
<span class="go">&#39;CMT05&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keyFnum</span><span class="p">(</span><span class="s1">&#39;50 0&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">invalid literal for int() with base 10: &#39;50 0&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.parse_header_line">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">parse_header_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">linedata</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.parse_header_line" title="Permalink to this definition"></a></dt>
<dd><p>Splits a header line into components: cmtkey, text name, comment.</p>
<p>Assumes a CMT block header line looks like this:
// CMT07 // Heath Tundra - (ma…..</p>
<p>or like this:
// CMT07 // Heath Tundra // some other comment…</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> (<em>string</em>) – Assumed to be valid header line of a CMT datablock.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple containing the (cmtkey, cmtname, cmtcomment)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.read_paramfile">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">read_paramfile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">thefile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.read_paramfile" title="Permalink to this definition"></a></dt>
<dd><p>Opens and reads a file, returning the data as a list of lines (with newlines).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>theFile</strong> (<em>str</em>) – A path to a file to open and read.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data</strong> – A list of strings (with newlines at the end of each string).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>[str, str, str, …]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.replace_CMT_data">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">replace_CMT_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">origfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.replace_CMT_data" title="Permalink to this definition"></a></dt>
<dd><p>Replaces the CMT datablock in <cite>origfile</cite> with the data block found in
<cite>newfile</cite> for the provided <cite>cmtnum</cite>. If <cite>overwrite</cite> is True, then <cite>origfile</cite>
is written with the new data. Returns a list of lines which can then be
printed to stdout or otherwise redirected to a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>origfile</strong> (<em>str</em>) – Path to a file with CMT data blocks.</p></li>
<li><p><strong>newfile</strong> (<em>str</em>) – Path to a file with CMT data blocks.</p></li>
<li><p><strong>cmtnum</strong> (<em>int</em>) – Number of the CMT to look for.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of lines.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.smart_format">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">smart_format</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basefmt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'{:12.4f}</span> <span class="pre">'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">toolongfmt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'{:12.3e}</span> <span class="pre">'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.smart_format" title="Permalink to this definition"></a></dt>
<dd><p>Provides a flexible method for printing different number formats.</p>
<p>Tries to assess the length of the string version of x and apply different
formats based on the length. While the formats are flexible using
keyword arguments, the defauts are generally for fixed decimal notation for
shorter numbers and scientific notation for longer numbers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>anything that can cast to a float</em>) – The value to format.</p></li>
<li><p><strong>n</strong> (<em>int</em>) – The length at which the function switches between basefmt and toolongfmt.</p></li>
<li><p><strong>basefmt</strong> (<em>a format string</em>) – The format to use for x if string representation of x is shorter than n.</p></li>
<li><p><strong>toolongfmt</strong> (<em>a format string</em>) – The format to use for x if string representation of x is longer than n.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>str</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>formatted version of x</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.standardize_pftnames">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">standardize_pftnames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.standardize_pftnames" title="Permalink to this definition"></a></dt>
<dd><p>Replaces any spaces, dots, underscores or dashes with CamelCase.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>names</strong> (<em>list</em><em>, </em><em>required</em>) – A list of strings, with PFT names.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of strings with each item changed to CamelCase.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">standardize_pftnames</span><span class="p">([</span><span class="s1">&#39;Test 1&#39;</span><span class="p">,</span><span class="s1">&#39;Test-32&#39;</span><span class="p">,</span><span class="s1">&#39;test_6&#39;</span><span class="p">,</span><span class="s1">&#39;test.34.helper&#39;</span><span class="p">])</span>
<span class="go">[&#39;Test1&#39;, &#39;Test32&#39;, &#39;Test6&#39;, &#39;Test34Helper&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.update_inplace">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">update_inplace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pftnum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.update_inplace" title="Permalink to this definition"></a></dt>
<dd><p>Updates a parameter value in a parameter file. This will overwrite the
existing parameter file! Also note that it will remove all other CMTs
in the file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>new_value</strong> (<em>float</em>) – The new parameter value.</p></li>
<li><p><strong>param_dir</strong> (<em>str</em>) – The directory of parameter files that should be updated.</p></li>
<li><p><strong>pname</strong> (<em>str</em>) – The name of the parameter to modify.</p></li>
<li><p><strong>cmtnum</strong> (<em>int</em>) – The number of the CMT (community type) where the parameter should be modifed</p></li>
<li><p><strong>pftnum</strong> (<em>int</em>) – The number of the PFT that should be modified - only applicable
for PFT specific parameters! Otherwise leave as None.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.param.which_file">
<span class="sig-prename descclassname"><span class="pre">util.param.</span></span><span class="sig-name descname"><span class="pre">which_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lookup_struct</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.param.which_file" title="Permalink to this definition"></a></dt>
<dd><p>Given a parameter directory and parameter name, searches the
files to find which file the parameter is defined in.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pdir</strong> (<em>str</em>) – A path to a directort of parameter files.</p></li>
<li><p><strong>pname</strong> (<em>str</em>) – Name of the parameter to lookup.</p></li>
<li><p><strong>lookup_struct</strong> (<em>dict</em><em>, </em><em>default=None</em>) – Mapping from filenames to parameter lists. This optional
parameter allows passing in the lookup table which will be
more efficient if <cite>which_file(…)</cite> is called inside a loop
and the <cite>lookup_struct</cite> doesn’t need to be rebuilt each time.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>filename</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>if found, othewise raises RuntimeError!</p>
</dd>
</dl>
<p>:raises RuntimeError : when parameter is not found in any of the files in the directory.:</p>
</dd></dl>

</section>
<section id="module-util.output">
<span id="util-output"></span><h1>util.output<a class="headerlink" href="#module-util.output" title="Permalink to this heading"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="util.output.average_monthly_pool_to_yearly">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">average_monthly_pool_to_yearly</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.average_monthly_pool_to_yearly" title="Permalink to this definition"></a></dt>
<dd><p>Expects <cite>data</cite> to be a 3D, 4D, or 5D numpy MASKED array with dimensions
<cite>(time, layers, y, x)</cite>, <cite>(time, pft, y, x)</cite>  or <cite>(time, pftpart, pft, y, x)</cite>
and the size of the time dimension to be an even multiple of 12. The calling
client is expected to set up the mask correctly, i.e. if data is read from a
netcdf file, then using the _FillValue for the mask.</p>
<p>The function will compute the average of the input array along the time
dimension in strides of 12.</p>
<p>Returns a 3D, 4D, or 5D numpy array with dimensions e.g. <cite>(time, layers, y, x)</cite>,
(same as input), but the length of the returned time dimension will be
1/12th of the length of the input array.</p>
<p>Note: this function contains a loop and could probably be vectorized somehow
with some fancy numpy indexing.</p>
<dl>
<dt>Examples:</dt><dd><p>Load a monthly file with soil layer data and convert it to yearly.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">util.output</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">soc</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="s1">&#39;all-merged/SOC_monthly_tr.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">soc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;SOC&#39;</span><span class="p">][:],</span> <span class="n">soc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;SOC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="mi">99999</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">average_monthly_pool_to_yearly</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1308, 22, 10, 10) (109, 22, 10, 10)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.boxplot_by_pft">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">boxplot_by_pft</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_veg_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_run_status</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.boxplot_by_pft" title="Permalink to this definition"></a></dt>
<dd><p>Work in progress…</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.boxplot_monthlies">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">boxplot_monthlies</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_veg_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_run_status</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">facecolor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'blue'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.boxplot_monthlies" title="Permalink to this definition"></a></dt>
<dd><p>Makes a boxplot showing distribution of values for <cite>var</cite> for each month,
averaged over spatial dimensions, and only considering <cite>cmtnum</cite>. If multiple
stages are specified, the stages will be stitched together along the time
dimension before the distributions are calculated.</p>
<p><cite>var</cite>: (str) one of the dvmdostem output variables.
<cite>stages</cite>: (list) must contain one or more of “pr”,”eq”,”sp”,”tr”,”sc”.
<cite>cmtnum</cite>: (int) which CMT to work with.
<cite>ref_veg_map</cite>: (str) path to a vegetation map to use for masking cmts
<cite>ref_run_status</cite>: (str) path to run status map to use for masking failed cells
<cite>facecolor</cite>: (str) color to use for the box.</p>
<p>Returns <cite>None</cite></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.build_full_datetimeindex">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">build_full_datetimeindex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeres</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.build_full_datetimeindex" title="Permalink to this definition"></a></dt>
<dd><p>Returns a <code class="docutils literal notranslate"><span class="pre">pandas.DatetimeIndex</span></code> covering the range of the two
input datasets. Assumes that the two input datasets are consecutive
monotonic, and not missing any points.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.check_files">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">check_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fnames</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.check_files" title="Permalink to this definition"></a></dt>
<dd><p>A work in progress for verifying assumptions about input files, <cite>fnames</cite>.</p>
<p>Prints messages to stdout.</p>
<p>Returns <cite>None</cite>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.get_last_n_eq">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">get_last_n_eq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeres</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'yearly'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fileprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.get_last_n_eq" title="Permalink to this definition"></a></dt>
<dd><p>Work in progress for getting the last few year of equlibrium stage for
calibration.</p>
<p>Maybe the default for <code class="docutils literal notranslate"><span class="pre">n</span></code> should be 12 so that if the <code class="docutils literal notranslate"><span class="pre">timeres</span></code> is monthly
it gets the lasy year?</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.get_start_end">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">get_start_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timevar</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.get_start_end" title="Permalink to this definition"></a></dt>
<dd><p>Returns CF Times. use .strftime() to convert to python datetimes</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.load_output_dataframe">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">load_output_dataframe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeres</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px_y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px_x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fileprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.load_output_dataframe" title="Permalink to this definition"></a></dt>
<dd><p>Builds a pandas.DataFrame for the requested output variable.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var</strong> (<em>str</em>) – The variable of interest. Must be a dvmdostem output variable, i.e.
GPP.</p></li>
<li><p><strong>timeres</strong> (<em>str</em>) – String: ‘yearly’, ‘monthly’, or ‘daily’. Used to find
and open the appropriate files as well as set the DatetimeIndex.</p></li>
<li><p><strong>px_y</strong> (<em>int</em>) – Index of the pixel to work with, latitude dimension.</p></li>
<li><p><strong>px_x</strong> (<em>int</em>) – Index of pixel to work with, longitude dimension.</p></li>
<li><p><strong>fileprefix</strong> (<em>str</em>) – The path, absolute or relative, where the function will look for files.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>df</strong> (<em>pandas.DataFrame</em>) – A DataFrame with data for the requested <code class="docutils literal notranslate"><span class="pre">var</span></code>.
The DataFrame should have a complete DatetimeIndex.</p></li>
<li><p><strong>meta</strong> (<em>dict</em>) – A small dictionary containing metadata about the datasets in the
dataframe. Namely, the units.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.load_trsc_dataframe">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">load_trsc_dataframe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeres</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px_y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px_x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fileprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.load_trsc_dataframe" title="Permalink to this definition"></a></dt>
<dd><p>Builds a pandas.DataFrame for the requested output variable with the
transient and scenario data merged together and a complete
DatetimeIndex.</p>
<p>This function does not handle by-compartment files yet.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var</strong> (<em>str</em>) – The variable of interest. Must be a dvmdostem output variable, i.e.
GPP.</p></li>
<li><p><strong>timeres</strong> (<em>str</em>) – String of either ‘monthly’ or ‘yearly’ that will be used to find
and open the appropriate files as well as set the DatetimeIndex.</p></li>
<li><p><strong>px_y</strong> (<em>int</em>) – Index of the pixel to work with, latitude dimension.</p></li>
<li><p><strong>px_x</strong> (<em>int</em>) – Index of pixel to work with, longitude dimension.</p></li>
<li><p><strong>fileprefix</strong> (<em>str</em>) – The path, absolute or relative, where the function will look for files.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>df</strong> (<em>pandas.DataFrame</em>) – A DataFrame with data for the requested <code class="docutils literal notranslate"><span class="pre">var</span></code> from transient and
scenario output files. The DataFrame should have a complete
DatetimeIndex.</p></li>
<li><p><strong>meta</strong> (<em>dict</em>) – A small dictionary containing metadata about the datasets in the
dataframe. Namely, the units.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.mask_by_cmt">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">mask_by_cmt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vegmap_filepath</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.mask_by_cmt" title="Permalink to this definition"></a></dt>
<dd><p>Expects <cite>data</cite> to be at least a 2D array with the last two dimensions being
(y, x). <cite>cmtnum</cite> is the community type number that will remain unmasked
in the final data. <cite>vegmap_filepath</cite> should be the path to dvmdostem input
vegetation map file, which has dimensions (y,x) and an integer specifying
the CMT number for each pixel, under the variable ‘veg_class’.</p>
<p>Returns a numpy  masked array with the same dimensions as <cite>data</cite>. In the
returned array, data for pixels in <cite>vegmap_filepath</cite> equal to <cite>cmtnum</cite> will
unmasked.</p>
<p>Example:</p>
<blockquote>
<div><p># An nd veg mask
# Assumed that the shape of data is either
# 3D (time, y, x),
# 4D (time, pft, y, x) or (time, layer, y, x) or
# 5D (time, pftpart, pft, y, x),
# and that in any case, the last two dimensions are y and x</p>
<p># For example:
In [142]: ba = np.random.randint(0,100,(2,3,4,5,5))</p>
<p>In [143]: np.broadcast_to(np.random.randint(0,2,(5,5)), ba.shape).shape
Out[143]: (2, 3, 4, 5, 5)</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.mask_by_failed_run_status">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">mask_by_failed_run_status</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_status_filepath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'run_status.nc'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.mask_by_failed_run_status" title="Permalink to this definition"></a></dt>
<dd><p>Masks out any data for which the run status is &lt; 0 in the <cite>run_status_filepath</cite>.</p>
<dl class="simple">
<dt><cite>data</cite>: (numpy.ndarray) must have at least 2 dimensions (y, x) and they must</dt><dd><p>be the last dimensions.</p>
</dd>
</dl>
<p><cite>run_status_file</cite>: (str) path to a dvmdostem run_status.nc file that has
dimensions (y,x) and single variable run_status(y,x) that has positive values
for successfully run pixels and negative values for failed pixels.</p>
<p>Returns a numpy masked array the same shape as <cite>data</cite> with all the data for
failed pixels masked out.</p>
<p>Example: see mask_by_cmt(…)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.plot_basic_timeseries">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">plot_basic_timeseries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vars2plot</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spatial_y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spatial_x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_resolution</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">folder</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.plot_basic_timeseries" title="Permalink to this definition"></a></dt>
<dd><p>Make a basic timeseries plot, one subplot per variable.</p>
<p>Not sure yet how should handle summarizing over layers, pfts, etc.</p>
<p>Assembles expected file name for data based on args. i.e. GPP_monthly_eq.nc
Raises FileNotFoundError if files does not exist.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vars2plot</strong> (<em>list of variable names</em>) – </p></li>
<li><p><strong>spatial_y</strong> (<em>pixel coordinates to plot i.e. 0</em>) – </p></li>
<li><p><strong>spatial_x</strong> (<em>pixel coordinates to plot i.e. 0</em>) – </p></li>
<li><p><strong>time_resolution</strong> (<em>str</em><em>, </em><em>'yearly'</em><em>, </em><em>'monthly'</em><em>, or </em><em>'daily'</em>) – </p></li>
<li><p><strong>stages</strong> (<em>list of stages to plot e.g.</em><em> [</em><em>'eq'</em><em>, </em><em>'sp'</em><em>, </em><em>'tr'</em><em>, </em><em>'sc'</em><em>]</em>) – </p></li>
<li><p><strong>folder</strong> (<em>str</em><em>, </em><em>path to directory with output data files</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.plot_fronts">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">plot_fronts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.plot_fronts" title="Permalink to this definition"></a></dt>
<dd><p>Makes a timeseries plot of all the fronts that are output. The X axis is time,
the Y axis is depth from surface (0 at the top of the plot). Each front will
have a line on the plot.</p>
<p>Blue dots are used for FREEZING fronts (frozen above, warm below, values &gt; 0)
Red is used for THAWING fronts (warm above, frozen below, value &lt; 0)</p>
<p># NOTE:
# In the model, there are two places that fronts info is stored:
# a pair of deques and a pair of arrays. The arrays are set to have a max
# size of 10 (MAX_FRONTS or something like that) As the model runs, the
# values are written periodically from the dequees into the arrays. The
# arrays are the structures that are output to the netcdf files. Our output
# netcdf files and output_spec files are not setup to deal with a “fronts”
# dimension. So for now, since we know there will only be
# 10 fronts, we’ll store the stuff in files with a layer dimension, using the
# first 10 slots. After a little testing it looks like there are rarely more
# than 2 fronts, so this setup is not space efficient.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.plot_inputs">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">plot_inputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hist_fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proj_fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_veg_map</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.plot_inputs" title="Permalink to this definition"></a></dt>
<dd><p>Plots the historic and projected climate inputs, averaging over the spatial
dimensions and with shading for min/max.</p>
<p><cite>cmtnum</cite>: (int) CMT to work with, must be in the veg map, see mask_by_cmt(..).</p>
<p><cite>hist_fname</cite>: (str) path to a dvmdostem historic input file.</p>
<p><cite>proj_fname</cite>: (str) path to a dvmdostem projected input file.</p>
<p>The historic and projected input files are assumed to be have the variables
tair, precip, vapor_press, and nirr all with the dimensions (time, y, x).
The files are assumed to be monthly resolution.</p>
<p>Returns <cite>None</cite>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.plot_soil_layers">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">plot_soil_layers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#util.output.plot_soil_layers" title="Permalink to this definition"></a></dt>
<dd><p>WORK IN PROGRESS!</p>
<p>Attempts to display an intuitive representation of the soil column using
a horizontal bar chart.</p>
<blockquote>
<div><ul class="simple">
<li><p>bar width is set by the value of the variable under investigation</p></li>
<li><p>bar color is set by the LAYERTYPE</p></li>
<li><p>bar height (thickness?) is controlled by the LAYERDZ</p></li>
</ul>
</div></blockquote>
<p>The y axis is depth (cumulative sum of LAYERDZ)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.plot_soil_layers2">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">plot_soil_layers2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.plot_soil_layers2" title="Permalink to this definition"></a></dt>
<dd><p>Makes plots of soil profile variables. Generates one plot/axis for each
variable specified. Y axis is the depth, X axis is the value of the variable.
Plots include horizontal lines marking layer boundaries.</p>
<p>Calling code must supply`args` which must be a dictionary with the following
keys set:
<cite>outfolder</cite>: (string) a path to a folder containing dvmdostem output files.
<cite>time</cite>: (int) index along time axis to plot
<cite>yx</cite>: (tuple) the pixel coordinates to source for the plot(s)
<cite>timeres</cite>: (string) either ‘monthly’, ‘yearly’, or ‘daily’ (daily is untested)
<cite>stage</cite>: (string) the run stage to plot from
<cite>vars</cite>: a list of variables names to plot, e.g. [‘TLAYER’, ‘SOC’, ‘ORGN’]</p>
<p>The function will look in <cite>outfolder</cite> for the appropriate dvmdostem output
files basedon variable name, stage, and time resolution.</p>
<p>NOTE: The LAYERDZ and LAYERDEPTH files must be present in <cite>outfolder</cite> for
the speficied <cite>stage</cite> and <cite>timeres</cite>!</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.plot_spatial_summary_timeseries">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">plot_spatial_summary_timeseries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_veg_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_run_status</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.plot_spatial_summary_timeseries" title="Permalink to this definition"></a></dt>
<dd><p>Plots a single line with min/max shading representing the <cite>var</cite> averaged over
the spatial dimension, considering only pixels for <cite>cmtnum</cite>. Stitches together
data for the specified <cite>stages</cite>.</p>
<p><cite>var</cite>: (string) must be one of the dvmdostem output variables (upper case).</p>
<p><cite>timesteps</cite>: (string) must be one of “monthly” or “yearly”.</p>
<p><cite>cmtnum</cite>: (int) must be a number found in the veg map, see <cite>mask_by_cmt(..)</cite>.</p>
<p><cite>stages</cite>: (list) must contain one or more of “pr”,”eq”,”sp”,”tr”,”sc”.</p>
<p><cite>ref_veg_map</cite>: (str) must be a file path to a dvmdostem vegetation input map
with dimensions (y, x) and a single variable veg_class(y,x) with a number for
representing the community type for that pixel.</p>
<p><cite>ref_run_status</cite>: (str) must be a file path to a dvmdostem run_status.nc map
with dimensions (y,x) and a single variable run_status(y, with a number for
how the pixel completed its run.</p>
<p><cite>ax</cite>: (matplotlib.axes._subplots.AxesSubplot instance) will plot line(s) on
this axes instance. If ax in None, then will create (and show) a new figure
and plot.</p>
<p>Attempts to find the requsite files for <cite>var</cite>, <cite>timestep</cite> and <cite>stages</cite>.
Plots a timeseries of variable <cite>var</cite> after averaging over the spatial
dimensions. If the data found in the input files is higher dimensionality
than (time, y, x), for example (time, pft, y, x), then the data is
summed across PFTs before plotting.</p>
<p>Returns <cite>None</cite></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.print_soil_table">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">print_soil_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeres</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestep</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.print_soil_table" title="Permalink to this definition"></a></dt>
<dd><p>Prints a table to stdout with all the soil info.</p>
<p>Looks in the <cite>outdir</cite> for any .nc file with ‘layer’ in the dimension list,
and <cite>stage</cite> and <cite>timeres</cite> in the name, e.g. “SOC_monthly_tr.nc”. Each
appropriate file found will get a column in the printed table. The printed
table will be for the pixel specified by <cite>Y</cite> and <cite>X</cite> and for the specified
<cite>timestep</cite></p>
<p>Prints a very wide table if there are many by-layer outputs available. A neat
addition to this function would be a better way to control the width.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.pull_data_wrapper">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">pull_data_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">required_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.pull_data_wrapper" title="Permalink to this definition"></a></dt>
<dd><p>Extracts data from an netcdf file.</p>
<p><cite>args</cite> must be a dict with settings for outfolder, timeres, and stage.
<cite>variable</cite> must be a string with the variable name that is expected to be in
the netcdf file. The file is expected to be names like this:
“VARIABLE_TIMERES_STAGE.nc” and is expected to be present in the
args.outfolder.</p>
<p>If required_dims is passed, then the dimensions of the variable to extract
are checked against the list and a RuntimeError is thrown if there is a
a problem.</p>
<p>Returns a tuple (data, units), where data is a numpy array or masked array
and units is a string that is extracted from the attributs of the netcdf file.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.stitch_stages">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">stitch_stages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fileprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">with_dti</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.stitch_stages" title="Permalink to this definition"></a></dt>
<dd><p>Glues files together along the time axis.</p>
<p>Outputs from <code class="docutils literal notranslate"><span class="pre">dvmdostem</span></code> assume one variable per file and the following
file-naming pattern:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">var_timestep_stage.nc</span></code></p>
</div></blockquote>
<p>This function makes the following additional assumptions about the files:</p>
<blockquote>
<div><ul class="simple">
<li><p>All files for different timesteps have the same dimensions</p></li>
<li><p>The file’s variable name is the same as the variable name in the filename.</p></li>
<li><p>There is a units attribute.</p></li>
</ul>
</div></blockquote>
<p>Only able to return a <code class="docutils literal notranslate"><span class="pre">pandas.DatetimeIndex</span></code> for a transient (tr) and
scenario (sc) files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var</strong> (<em>str</em>) – An uppercase string matching one of the dvmdostem output names.</p></li>
<li><p><strong>timestep</strong> (<em>str</em>) – Must be one of ‘yearly’ or ‘monthly’, and match the files present in
<code class="docutils literal notranslate"><span class="pre">fileprefix</span></code> for the <code class="docutils literal notranslate"><span class="pre">var</span></code>.</p></li>
<li><p><strong>stages</strong> (<em>list of strings</em>) – Ordered list of strings for the stages to stitch together, i.e. for all
stages, in normal order: <code class="docutils literal notranslate"><span class="pre">['pr','eq','sp','tr','sc']</span></code>.</p></li>
<li><p><strong>fileprefix</strong> (<em>str</em>) – A path that will be pre-pended to the filenames for opening files in a
different directory.</p></li>
<li><p><strong>with_dti</strong> (<em>bool</em>) – Whether or not a full pandas.DatetimeIndex should be retured.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>data</strong> (<em>np.array</em>) – A multi-dimensonal numpy array that is the concatenatio of the input arrays
along the time axis.</p></li>
<li><p><strong>units_str</strong> (<em>str</em>) – The units of the variable in question, read from the attributes of the
netCDF files.</p></li>
<li><p><strong>dims</strong> (<em>tuple</em>) – A list of strings naming the dimensions of the <code class="docutils literal notranslate"><span class="pre">data</span></code> array.</p></li>
<li><p><strong>dti</strong> (<em>(optional) pandas.DatetimeIndex</em>) – The DatetimeIndex should span the time axis (first axis) of the <code class="docutils literal notranslate"><span class="pre">data</span></code>
array.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.sum_across_compartments">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">sum_across_compartments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.sum_across_compartments" title="Permalink to this definition"></a></dt>
<dd><p>Expects <cite>data</cite> to be a 5D numpy array with dimensions
<cite>(time, pftpart, pft, y, x)</cite>.</p>
<p>Returns a 4D array that has been summed over the <cite>pftpart</cite> dimension,
effectively creating a new array with totals for a PFT instead of having
values split by compartment.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.sum_across_layers">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">sum_across_layers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.sum_across_layers" title="Permalink to this definition"></a></dt>
<dd><p>Expects <cite>data</cite> to be a 4D numpy array with dimensions
<cite>(time, layers, y, x)</cite>.</p>
<p>Returns a 3D array that has been summed over the <cite>layer</cite> dimension,
effectively creating a new array with totals for an entire gridcell/pixel
instead of having the totals broken out by layer.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.sum_across_pfts">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">sum_across_pfts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.sum_across_pfts" title="Permalink to this definition"></a></dt>
<dd><p>Expects <cite>data</cite> to be a 4D numpy array with dimensions
<cite>(time, pft, y, x)</cite>.</p>
<p>Returns a 3D array that has been summed over the <cite>pft</cite> dimension, effectively
creating a new array with totals for an entire gridcell/pixel instead of
having the totals broken out by PFT.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.sum_monthly_flux_to_yearly">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">sum_monthly_flux_to_yearly</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.sum_monthly_flux_to_yearly" title="Permalink to this definition"></a></dt>
<dd><p>Expects <cite>data</cite> to be at least a 1D array, with the first axis being time.
Also assumes that the time axis starts and stops on Jan 1 and Dec 31. In
otherwords, if you had a 2 years of monthly data that ran from Aug 1 thru
July 31, this function would NOT work!</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.output.workhorse_spatial_summary_plot">
<span class="sig-prename descclassname"><span class="pre">util.output.</span></span><span class="sig-name descname"><span class="pre">workhorse_spatial_summary_plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtnum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yunits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">varname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.output.workhorse_spatial_summary_plot" title="Permalink to this definition"></a></dt>
<dd><p>Worker function, plots a line for average along time axis (axis 0),
with shading for min and max.</p>
<p><cite>data</cite>: (numpy.ndarray) must have dimensions (time, y, x).</p>
<p><cite>cmtnum</cite>: (int)  used for the plot title.</p>
<p><cite>varname</cite>: (str) used for the plot title</p>
<dl class="simple">
<dt><cite>stages</cite>: (list) used for the plot title, must contain one or</dt><dd><p>more of “pr”,”eq”,”sp”,”tr”,”sc”.</p>
</dd>
</dl>
<p><cite>ax</cite>: (matplotlib.axes._subplots.AxesSubplot instance) will plot line(s) on
this axes instance. If ax in None, then will create (and show) a new figure
and plot.</p>
<p>Returns <cite>None</cite></p>
</dd></dl>

</section>
<section id="module-util.input">
<span id="util-input"></span><h1>util.input<a class="headerlink" href="#module-util.input" title="Permalink to this heading"></a></h1>
<dl class="py exception">
<dt class="sig sig-object py" id="util.input.BadInputFilesValueError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">BadInputFilesValueError</span></span><a class="headerlink" href="#util.input.BadInputFilesValueError" title="Permalink to this definition"></a></dt>
<dd><p>Raise when there is a problem with the input files.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="util.input.MissingInputFilesValueError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">MissingInputFilesValueError</span></span><a class="headerlink" href="#util.input.MissingInputFilesValueError" title="Permalink to this definition"></a></dt>
<dd><p>Raise when not enough files are present.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="util.input.MustSupplyPixelCoordsError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">MustSupplyPixelCoordsError</span></span><a class="headerlink" href="#util.input.MustSupplyPixelCoordsError" title="Permalink to this definition"></a></dt>
<dd><p>Raise when user must supply pixel coordinates(i.e. command line flag –yx)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.climate_gap_count_plot">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">climate_gap_count_plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.input.climate_gap_count_plot" title="Permalink to this definition"></a></dt>
<dd><p>Creates plots showing how many missing datapoints exist for each pixel.</p>
<p>Creates 2 figures: first from the historic file and then from the projected
file.</p>
<p>Each variable is shown in a different sub-plot. There are some idiosyncracies
surrouding the labeling of the colorbar, so use with caution! But this should
give a rough idea where there are bad pixels and how bad they are.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.climate_ts_plot">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">climate_ts_plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.input.climate_ts_plot" title="Permalink to this definition"></a></dt>
<dd><p>Make time series plots of the 4 climate driver variables.</p>
<p>There are 2 modes controlled by the value of <cite>args.type</cite>. In <cite>raw</cite> mode, 2
figures are generated, one for historic and one for projected data (with the
<cite>args.stitch</cite> argument, the data is concatenated along the temporal
dimension and only one figure is shown). Each figure has 4 subplots, one for
each variable. The data on each plot is shown directly from the input files,
so it is monthly resolution. The plot is generally too dense to read without
zooming in, but ALL the data is shown, un-adultered.</p>
<p>In <cite>spatial-temporal-summary</cite> mode, one figure is created (the data is
automatically stitched along the temporal dimension) with one subplot for each
variable. The data that is shown is also averaged over the spatial dimensions
of the input files AND resampled to an annual resolution along the time
dimension.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.cmdline_define">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">cmdline_define</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#util.input.cmdline_define" title="Permalink to this definition"></a></dt>
<dd><p>Define the command line interface, return the parser object.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.crop_attr_string">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">crop_attr_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.input.crop_attr_string" title="Permalink to this definition"></a></dt>
<dd><p>Returns a string to be included as a netCDF global attribute named “crop”.</p>
<p>The string will start with the filename and function name responsible for
creating the (new) input file, and if provided, will include values for size
and offset. The size attributes are relatively self-explanatory (by looking
at the size of the resulting file), and so can generally be ignored. The
offset arguments are much more important to include.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ys</strong> (<em>str</em>) – Strings denoting the spatial size of the domain.</p></li>
<li><p><strong>xs</strong> (<em>str</em>) – Strings denoting the spatial size of the domain.</p></li>
<li><p><strong>yo</strong> (<em>str</em>) – Strings denoting the pixel offsets used to crop the data from the input dataset</p></li>
<li><p><strong>xo</strong> (<em>str</em>) – Strings denoting the pixel offsets used to crop the data from the input dataset</p></li>
<li><p><strong>msg</strong> (<em>str</em>) – An additional message string to be included.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>s</strong> – A string something like:
“./scripts/input.py::crop_file –ysize 3 –xsize 4 –yx 0 0</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.crop_file">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">crop_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">infile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ysize</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xsize</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.input.crop_file" title="Permalink to this definition"></a></dt>
<dd><p>Creates a new <cite>outfile</cite> and copies data from the <cite>infile</cite> to the new <cite>outfile</cite>
according to <cite>y</cite>, <cite>x</cite>, and respective size parameters. Copys all attributes
and adds a new attribute describing this crop step.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.crop_wrapper">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">crop_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.input.crop_wrapper" title="Permalink to this definition"></a></dt>
<dd><p>Parses input folder name to find tag, and creates appropriately named
output directory alongside the input directory. Calls the crop_file
function for each netcdf file found in the input directory.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.cropper">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">cropper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/tmp/smaller.nc'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_lonlat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.input.cropper" title="Permalink to this definition"></a></dt>
<dd><p>Very thin wrapper around gdal_translate.</p>
<p>Advantage: it will update the geo referencing info
Disadvantage: this may not create a valid 1x1 dataset</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.mkdir_p">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">mkdir_p</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.input.mkdir_p" title="Permalink to this definition"></a></dt>
<dd><p>Emulates the shell’s <cite>mkdir -p</cite>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.tunnel_fast">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">tunnel_fast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">latvar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lonvar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.input.tunnel_fast" title="Permalink to this definition"></a></dt>
<dd><p>Find closest pair in a set of (lat,lon) pairs to specified query point.
latvar - 2D latitude data, usually from reading a netCDF dataset
lonvar - 2D longitude data, usually from reading a netCDF dataset
lat0,lon0 - query point
Returns iy,ix such that the square of the tunnel distance
between (latval[it,ix],lonval[iy,ix]) and (lat0,lon0)
is minimum.
Code from Unidata’s Python Workshop:
<a class="reference external" href="https://github.com/Unidata/unidata-python-workshop">https://github.com/Unidata/unidata-python-workshop</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.input.verify_input_files">
<span class="sig-prename descclassname"><span class="pre">util.input.</span></span><span class="sig-name descname"><span class="pre">verify_input_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_folder</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.input.verify_input_files" title="Permalink to this definition"></a></dt>
<dd><p>Raises various exceptions if there are problems with the files in the in_folder.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>in_folder</strong> (<em>str</em>) – A path to a folder of dvmdostem inputs.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="#util.input.BadInputFilesValueError" title="util.input.BadInputFilesValueError"><strong>BadInputFilesValueError</strong></a> – </p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-util.metrics">
<span id="util-metrics"></span><h1>util.metrics<a class="headerlink" href="#module-util.metrics" title="Permalink to this heading"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="util.metrics.eq_quality">
<span class="sig-prename descclassname"><span class="pre">util.metrics.</span></span><span class="sig-name descname"><span class="pre">eq_quality</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fileprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmtkey</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">PXx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">PXy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pref</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.metrics.eq_quality" title="Permalink to this definition"></a></dt>
<dd><p>Draft … experimenting with measuring eq state…</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.metrics.plot_optimization_fit">
<span class="sig-prename descclassname"><span class="pre">util.metrics.</span></span><span class="sig-name descname"><span class="pre">plot_optimization_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ig_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opt_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed_out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ig_out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opt_out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">savefile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#util.metrics.plot_optimization_fit" title="Permalink to this definition"></a></dt>
<dd><p>Make a plot with three axes allowing an overview of optimization performance.</p>
<p>The first set of axes shows the parameter values use for the seed run, the
initial guess run, and the optimized run.</p>
<p>The second set of axes shows the model outputs for the seed run, the initial
guess run, and the optimizied run. The target values are shown as red dots.</p>
<p>The third set of axes show the “residulas” or model outputs - targets.</p>
<a class="reference internal image-reference" href="_images/metrics.plot_optimization_fit.png"><img alt="_images/metrics.plot_optimization_fit.png" src="_images/metrics.plot_optimization_fit.png" style="width: 80%;" /></a>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CLI_tools/outspec.html" class="btn btn-neutral float-left" title="outspec.py" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Tobey Carman, Ruth Rutter, Helene Genet, Eugenie Euskirchen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>